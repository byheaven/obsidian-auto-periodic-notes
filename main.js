/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the GitHub repository of this plugin.
*/

var Xt=Object.create;var Te=Object.defineProperty;var Zt=Object.getOwnPropertyDescriptor;var en=Object.getOwnPropertyNames;var tn=Object.getPrototypeOf,nn=Object.prototype.hasOwnProperty;var Ge=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),an=(t,e)=>{for(var n in e)Te(t,n,{get:e[n],enumerable:!0})},Je=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of en(e))!nn.call(t,a)&&a!==n&&Te(t,a,{get:()=>e[a],enumerable:!(i=Zt(e,a))||i.enumerable});return t};var Pe=(t,e,n)=>(n=t!=null?Xt(tn(t)):{},Je(e||!t||!t.__esModule?Te(n,"default",{value:t,enumerable:!0}):n,t)),on=t=>Je(Te({},"__esModule",{value:!0}),t);var Ie=Ge((li,ct)=>{var rn=Object.create,De=Object.defineProperty,ln=Object.getOwnPropertyDescriptor,sn=Object.getOwnPropertyNames,cn=Object.getPrototypeOf,dn=Object.prototype.hasOwnProperty,un=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),pn=(t,e)=>{for(var n in e)De(t,n,{get:e[n],enumerable:!0})},nt=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of sn(e))!dn.call(t,a)&&a!==n&&De(t,a,{get:()=>e[a],enumerable:!(i=ln(e,a))||i.enumerable});return t},ce=(t,e,n)=>(n=t!=null?rn(cn(t)):{},nt(e||!t||!t.__esModule?De(n,"default",{value:t,enumerable:!0}):n,t)),gn=t=>nt(De({},"__esModule",{value:!0}),t),de=un(t=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e=require("obsidian"),n="YYYY-MM-DD",i="gggg-[W]ww",a="YYYY-MM",o="YYYY-[Q]Q",s="YYYY";function d(r){var l,c;let u=window.app.plugins.getPlugin("periodic-notes");return u&&((c=(l=u.settings)==null?void 0:l[r])==null?void 0:c.enabled)}function g(){var r,l,c,u;try{let{internalPlugins:m,plugins:h}=window.app;if(d("daily")){let{format:T,folder:$,template:M}=((l=(r=h.getPlugin("periodic-notes"))==null?void 0:r.settings)==null?void 0:l.daily)||{};return{format:T||n,folder:($==null?void 0:$.trim())||"",template:(M==null?void 0:M.trim())||""}}let{folder:k,format:O,template:E}=((u=(c=m.getPluginById("daily-notes"))==null?void 0:c.instance)==null?void 0:u.options)||{};return{format:O||n,folder:(k==null?void 0:k.trim())||"",template:(E==null?void 0:E.trim())||""}}catch(m){console.info("No custom daily note settings found!",m)}}function p(){var r,l,c,u,m,h,k;try{let O=window.app.plugins,E=(r=O.getPlugin("calendar"))==null?void 0:r.options,T=(c=(l=O.getPlugin("periodic-notes"))==null?void 0:l.settings)==null?void 0:c.weekly;if(d("weekly"))return{format:T.format||i,folder:((u=T.folder)==null?void 0:u.trim())||"",template:((m=T.template)==null?void 0:m.trim())||""};let $=E||{};return{format:$.weeklyNoteFormat||i,folder:((h=$.weeklyNoteFolder)==null?void 0:h.trim())||"",template:((k=$.weeklyNoteTemplate)==null?void 0:k.trim())||""}}catch(O){console.info("No custom weekly note settings found!",O)}}function N(){var r,l,c,u;let m=window.app.plugins;try{let h=d("monthly")&&((l=(r=m.getPlugin("periodic-notes"))==null?void 0:r.settings)==null?void 0:l.monthly)||{};return{format:h.format||a,folder:((c=h.folder)==null?void 0:c.trim())||"",template:((u=h.template)==null?void 0:u.trim())||""}}catch(h){console.info("No custom monthly note settings found!",h)}}function v(){var r,l,c,u;let m=window.app.plugins;try{let h=d("quarterly")&&((l=(r=m.getPlugin("periodic-notes"))==null?void 0:r.settings)==null?void 0:l.quarterly)||{};return{format:h.format||o,folder:((c=h.folder)==null?void 0:c.trim())||"",template:((u=h.template)==null?void 0:u.trim())||""}}catch(h){console.info("No custom quarterly note settings found!",h)}}function y(){var r,l,c,u;let m=window.app.plugins;try{let h=d("yearly")&&((l=(r=m.getPlugin("periodic-notes"))==null?void 0:r.settings)==null?void 0:l.yearly)||{};return{format:h.format||s,folder:((c=h.folder)==null?void 0:c.trim())||"",template:((u=h.template)==null?void 0:u.trim())||""}}catch(h){console.info("No custom yearly note settings found!",h)}}function A(...r){let l=[];for(let u=0,m=r.length;u<m;u++)l=l.concat(r[u].split("/"));let c=[];for(let u=0,m=l.length;u<m;u++){let h=l[u];!h||h==="."||c.push(h)}return l[0]===""&&c.unshift(""),c.join("/")}function F(r){let l=r.substring(r.lastIndexOf("/")+1);return l.lastIndexOf(".")!=-1&&(l=l.substring(0,l.lastIndexOf("."))),l}async function D(r){let l=r.replace(/\\/g,"/").split("/");if(l.pop(),l.length){let c=A(...l);window.app.vault.getAbstractFileByPath(c)||await window.app.vault.createFolder(c)}}async function P(r,l){l.endsWith(".md")||(l+=".md");let c=e.normalizePath(A(r,l));return await D(c),c}async function b(r){let{metadataCache:l,vault:c}=window.app,u=e.normalizePath(r);if(u==="/")return Promise.resolve(["",null]);try{let m=l.getFirstLinkpathDest(u,""),h=await c.cachedRead(m),k=window.app.foldManager.load(m);return[h,k]}catch(m){return console.error(`Failed to read the daily note template '${u}'`,m),new e.Notice("Failed to read the daily note template"),["",null]}}function C(r,l="day"){let c=r.clone().startOf(l).format();return`${l}-${c}`}function G(r){return r.replace(/\[[^\]]*\]/g,"")}function ae(r,l){if(l==="week"){let c=G(r);return/w{1,2}/i.test(c)&&(/M{1,4}/.test(c)||/D{1,4}/.test(c))}return!1}function oe(r,l){return Ue(r.basename,l)}function Ft(r,l){return Ue(F(r),l)}function Ue(r,l){let c={day:g,week:p,month:N,quarter:v,year:y}[l]().format.split("/").pop(),u=window.moment(r,c,!0);if(!u.isValid())return null;if(ae(c,l)&&l==="week"){let m=G(c);if(/w{1,2}/i.test(m))return window.moment(r,c.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return u}var Ct=class extends Error{};async function He(r){let l=window.app,{vault:c}=l,u=window.moment,{template:m,format:h,folder:k}=g(),[O,E]=await b(m),T=r.format(h),$=await P(k,T);try{let M=await c.create($,O.replace(/{{\s*date\s*}}/gi,T).replace(/{{\s*time\s*}}/gi,u().format("HH:mm")).replace(/{{\s*title\s*}}/gi,T).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(q,U,J,Y,L,I)=>{let Se=u(),Fe=r.clone().set({hour:Se.get("hour"),minute:Se.get("minute"),second:Se.get("second")});return J&&Fe.add(parseInt(Y,10),L),I?Fe.format(I.substring(1).trim()):Fe.format(h)}).replace(/{{\s*yesterday\s*}}/gi,r.clone().subtract(1,"day").format(h)).replace(/{{\s*tomorrow\s*}}/gi,r.clone().add(1,"d").format(h)));return l.foldManager.save(M,E),M}catch(M){console.error(`Failed to create file: '${$}'`,M),new e.Notice("Unable to create new file.")}}function Et(r,l){var c;return(c=l[C(r,"day")])!=null?c:null}function It(){let{vault:r}=window.app,{folder:l}=g(),c=r.getAbstractFileByPath(e.normalizePath(l));if(!c)throw new Ct("Failed to find daily notes folder");let u={};return e.Vault.recurseChildren(c,m=>{if(m instanceof e.TFile){let h=oe(m,"day");if(h){let k=C(h,"day");u[k]=m}}}),u}var _t=class extends Error{};function Lt(){let{moment:r}=window,l=r.localeData()._week.dow,c=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;l;)c.push(c.shift()),l--;return c}function $t(r){return Lt().indexOf(r.toLowerCase())}async function Re(r){let{vault:l}=window.app,{template:c,format:u,folder:m}=p(),[h,k]=await b(c),O=r.format(u),E=await P(m,O);try{let T=await l.create(E,h.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,($,M,q,U,J,Y)=>{let L=window.moment(),I=r.clone().set({hour:L.get("hour"),minute:L.get("minute"),second:L.get("second")});return q&&I.add(parseInt(U,10),J),Y?I.format(Y.substring(1).trim()):I.format(u)}).replace(/{{\s*title\s*}}/gi,O).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,($,M,q)=>{let U=$t(M);return r.weekday(U).format(q.trim())}));return window.app.foldManager.save(T,k),T}catch(T){console.error(`Failed to create file: '${E}'`,T),new e.Notice("Unable to create new file.")}}function Mt(r,l){var c;return(c=l[C(r,"week")])!=null?c:null}function Yt(){let r={};if(!Qe())return r;let{vault:l}=window.app,{folder:c}=p(),u=l.getAbstractFileByPath(e.normalizePath(c));if(!u)throw new _t("Failed to find weekly notes folder");return e.Vault.recurseChildren(u,m=>{if(m instanceof e.TFile){let h=oe(m,"week");if(h){let k=C(h,"week");r[k]=m}}}),r}var xt=class extends Error{};async function Ve(r){let{vault:l}=window.app,{template:c,format:u,folder:m}=N(),[h,k]=await b(c),O=r.format(u),E=await P(m,O);try{let T=await l.create(E,h.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,($,M,q,U,J,Y)=>{let L=window.moment(),I=r.clone().set({hour:L.get("hour"),minute:L.get("minute"),second:L.get("second")});return q&&I.add(parseInt(U,10),J),Y?I.format(Y.substring(1).trim()):I.format(u)}).replace(/{{\s*date\s*}}/gi,O).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,O));return window.app.foldManager.save(T,k),T}catch(T){console.error(`Failed to create file: '${E}'`,T),new e.Notice("Unable to create new file.")}}function Wt(r,l){var c;return(c=l[C(r,"month")])!=null?c:null}function qt(){let r={};if(!je())return r;let{vault:l}=window.app,{folder:c}=N(),u=l.getAbstractFileByPath(e.normalizePath(c));if(!u)throw new xt("Failed to find monthly notes folder");return e.Vault.recurseChildren(u,m=>{if(m instanceof e.TFile){let h=oe(m,"month");if(h){let k=C(h,"month");r[k]=m}}}),r}var Ut=class extends Error{};async function Ht(r){let{vault:l}=window.app,{template:c,format:u,folder:m}=v(),[h,k]=await b(c),O=r.format(u),E=await P(m,O);try{let T=await l.create(E,h.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,($,M,q,U,J,Y)=>{let L=window.moment(),I=r.clone().set({hour:L.get("hour"),minute:L.get("minute"),second:L.get("second")});return q&&I.add(parseInt(U,10),J),Y?I.format(Y.substring(1).trim()):I.format(u)}).replace(/{{\s*date\s*}}/gi,O).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,O));return window.app.foldManager.save(T,k),T}catch(T){console.error(`Failed to create file: '${E}'`,T),new e.Notice("Unable to create new file.")}}function Rt(r,l){var c;return(c=l[C(r,"quarter")])!=null?c:null}function Vt(){let r={};if(!ze())return r;let{vault:l}=window.app,{folder:c}=v(),u=l.getAbstractFileByPath(e.normalizePath(c));if(!u)throw new Ut("Failed to find quarterly notes folder");return e.Vault.recurseChildren(u,m=>{if(m instanceof e.TFile){let h=oe(m,"quarter");if(h){let k=C(h,"quarter");r[k]=m}}}),r}var Qt=class extends Error{};async function jt(r){let{vault:l}=window.app,{template:c,format:u,folder:m}=y(),[h,k]=await b(c),O=r.format(u),E=await P(m,O);try{let T=await l.create(E,h.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,($,M,q,U,J,Y)=>{let L=window.moment(),I=r.clone().set({hour:L.get("hour"),minute:L.get("minute"),second:L.get("second")});return q&&I.add(parseInt(U,10),J),Y?I.format(Y.substring(1).trim()):I.format(u)}).replace(/{{\s*date\s*}}/gi,O).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,O));return window.app.foldManager.save(T,k),T}catch(T){console.error(`Failed to create file: '${E}'`,T),new e.Notice("Unable to create new file.")}}function zt(r,l){var c;return(c=l[C(r,"year")])!=null?c:null}function Bt(){let r={};if(!Be())return r;let{vault:l}=window.app,{folder:c}=y(),u=l.getAbstractFileByPath(e.normalizePath(c));if(!u)throw new Qt("Failed to find yearly notes folder");return e.Vault.recurseChildren(u,m=>{if(m instanceof e.TFile){let h=oe(m,"year");if(h){let k=C(h,"year");r[k]=m}}}),r}function Gt(){var r,l;let{app:c}=window,u=c.internalPlugins.plugins["daily-notes"];if(u&&u.enabled)return!0;let m=c.plugins.getPlugin("periodic-notes");return m&&((l=(r=m.settings)==null?void 0:r.daily)==null?void 0:l.enabled)}function Qe(){var r,l;let{app:c}=window;if(c.plugins.getPlugin("calendar"))return!0;let u=c.plugins.getPlugin("periodic-notes");return u&&((l=(r=u.settings)==null?void 0:r.weekly)==null?void 0:l.enabled)}function je(){var r,l;let{app:c}=window,u=c.plugins.getPlugin("periodic-notes");return u&&((l=(r=u.settings)==null?void 0:r.monthly)==null?void 0:l.enabled)}function ze(){var r,l;let{app:c}=window,u=c.plugins.getPlugin("periodic-notes");return u&&((l=(r=u.settings)==null?void 0:r.quarterly)==null?void 0:l.enabled)}function Be(){var r,l;let{app:c}=window,u=c.plugins.getPlugin("periodic-notes");return u&&((l=(r=u.settings)==null?void 0:r.yearly)==null?void 0:l.enabled)}function Jt(r){let l={day:g,week:p,month:N,quarter:v,year:y}[r];return l()}function Kt(r,l){return{day:He,month:Ve,week:Re}[r](l)}t.DEFAULT_DAILY_NOTE_FORMAT=n,t.DEFAULT_MONTHLY_NOTE_FORMAT=a,t.DEFAULT_QUARTERLY_NOTE_FORMAT=o,t.DEFAULT_WEEKLY_NOTE_FORMAT=i,t.DEFAULT_YEARLY_NOTE_FORMAT=s,t.appHasDailyNotesPluginLoaded=Gt,t.appHasMonthlyNotesPluginLoaded=je,t.appHasQuarterlyNotesPluginLoaded=ze,t.appHasWeeklyNotesPluginLoaded=Qe,t.appHasYearlyNotesPluginLoaded=Be,t.createDailyNote=He,t.createMonthlyNote=Ve,t.createPeriodicNote=Kt,t.createQuarterlyNote=Ht,t.createWeeklyNote=Re,t.createYearlyNote=jt,t.getAllDailyNotes=It,t.getAllMonthlyNotes=qt,t.getAllQuarterlyNotes=Vt,t.getAllWeeklyNotes=Yt,t.getAllYearlyNotes=Bt,t.getDailyNote=Et,t.getDailyNoteSettings=g,t.getDateFromFile=oe,t.getDateFromPath=Ft,t.getDateUID=C,t.getMonthlyNote=Wt,t.getMonthlyNoteSettings=N,t.getPeriodicNoteSettings=Jt,t.getQuarterlyNote=Rt,t.getQuarterlyNoteSettings=v,t.getTemplateInfo=b,t.getWeeklyNote=Mt,t.getWeeklyNoteSettings=p,t.getYearlyNote=zt,t.getYearlyNoteSettings=y}),it={};pn(it,{DEFAULT_SETTINGS:()=>Ee,DailyNote:()=>fn,MonthlyNote:()=>wn,PERIODIC_NOTES_EVENT_SETTING_UPDATED:()=>In,PLUGIN_NAME:()=>Ce,PeriodicNotesPluginAdapter:()=>En,QuarterlyNote:()=>vn,V0Provider:()=>at,V1Provider:()=>st,WeeklyNote:()=>Tn,YearlyNote:()=>Dn,checkCreateTime:()=>re});ct.exports=gn(it);var Ke=require("obsidian"),H=ce(de()),mn=1e3,ue=class{};function re(t){return t.stat.ctime>new Date().getTime()-mn}var hn=30,X="day",fn=class extends ue{constructor(){super(...arguments),this.date=(0,Ke.moment)()}getDate(){return(0,Ke.moment)().startOf(X)}async create(){let t=this.date.clone().startOf(X);return(0,H.createDailyNote)(t)}getAllPaths(){let t=(0,H.getAllDailyNotes)();return Object.entries(t).map(([e,n])=>n.path)}getCurrent(){return(0,H.getDailyNote)(this.date,(0,H.getAllDailyNotes)())}getNextDate(){return this.getDate().clone().add(1,X)}getPrevious(){let t=this.getDate().clone().subtract(1,X),e=t.clone().subtract(hn,X),n=(0,H.getAllDailyNotes)(),i;do i=(0,H.getDailyNote)(t,n),t.subtract(1,X);while(!i&&t.isAfter(e));return i}isPresent(){let t=this.date.clone().startOf(X),e=(0,H.getAllDailyNotes)();return!!(0,H.getDailyNote)(t,e)}isValid(t){let e=(0,H.getDailyNote)(this.getDate(),(0,H.getAllDailyNotes)());return e?e.name===t.name&&re(e):!1}},Xe=require("obsidian"),R=ce(de()),yn=12,Z="month",wn=class extends ue{constructor(){super(...arguments),this.date=(0,Xe.moment)()}getDate(){return(0,Xe.moment)().startOf(Z)}async create(){let t=this.date.clone().startOf(Z);return(0,R.createMonthlyNote)(t)}getAllPaths(){let t=(0,R.getAllMonthlyNotes)();return Object.entries(t).map(([e,n])=>n.path)}getCurrent(){return(0,R.getMonthlyNote)(this.date,(0,R.getAllMonthlyNotes)())}getNextDate(){return this.getDate().clone().add(1,Z)}getPrevious(){let t=this.getDate().clone().subtract(1,Z),e=t.clone().subtract(yn,Z),n=(0,R.getAllMonthlyNotes)(),i;do i=(0,R.getMonthlyNote)(t,n),t.subtract(1,Z);while(!i&&t.isAfter(e));return i}isPresent(){let t=this.date.clone().startOf(Z),e=(0,R.getAllMonthlyNotes)();return!!(0,R.getMonthlyNote)(t,e)}isValid(t){let e=(0,R.getMonthlyNote)(this.getDate(),(0,R.getAllMonthlyNotes)());return e?e.name===t.name&&re(e):!1}},Ze=require("obsidian"),V=ce(de()),Nn=4,ee="quarter",vn=class extends ue{constructor(){super(...arguments),this.date=(0,Ze.moment)()}getDate(){return(0,Ze.moment)().startOf(ee)}async create(){let t=this.date.clone().startOf(ee);return(0,V.createQuarterlyNote)(t)}getAllPaths(){let t=(0,V.getAllQuarterlyNotes)();return Object.entries(t).map(([e,n])=>n.path)}getCurrent(){return(0,V.getQuarterlyNote)(this.date,(0,V.getAllQuarterlyNotes)())}getNextDate(){return this.getDate().clone().add(1,ee)}getPrevious(){let t=this.getDate().clone().subtract(1,ee),e=t.clone().subtract(Nn,ee),n=(0,V.getAllQuarterlyNotes)(),i;do i=(0,V.getQuarterlyNote)(t,n),t.subtract(1,ee);while(!i&&t.isAfter(e));return i}isPresent(){let t=this.date.clone().startOf(ee),e=(0,V.getAllQuarterlyNotes)();return!!(0,V.getQuarterlyNote)(t,e)}isValid(t){let e=(0,V.getQuarterlyNote)(this.getDate(),(0,V.getAllQuarterlyNotes)());return e?e.name===t.name&&re(e):!1}},et=require("obsidian"),Q=ce(de()),bn=8,te="week",Tn=class extends ue{constructor(){super(...arguments),this.date=(0,et.moment)()}getDate(){return(0,et.moment)().startOf(te)}async create(){let t=this.date.clone().startOf(te);return(0,Q.createWeeklyNote)(t)}getAllPaths(){let t=(0,Q.getAllWeeklyNotes)();return Object.entries(t).map(([e,n])=>n.path)}getCurrent(){return(0,Q.getWeeklyNote)(this.date,(0,Q.getAllWeeklyNotes)())}getNextDate(){return this.getDate().clone().add(1,te)}getPrevious(){let t=this.getDate().clone().subtract(1,te),e=t.clone().subtract(bn,te),n=(0,Q.getAllWeeklyNotes)(),i;do i=(0,Q.getWeeklyNote)(t,n),t.subtract(1,te);while(!i&&t.isAfter(e));return i}isPresent(){let t=this.date.clone().startOf(te),e=(0,Q.getAllWeeklyNotes)();return!!(0,Q.getWeeklyNote)(t,e)}isValid(t){let e=(0,Q.getWeeklyNote)(this.getDate(),(0,Q.getAllWeeklyNotes)());return e?e.name===t.name&&re(e):!1}},tt=require("obsidian"),j=ce(de()),Pn=5,ne="year",Dn=class extends ue{constructor(){super(...arguments),this.date=(0,tt.moment)()}getDate(){return(0,tt.moment)().startOf(ne)}async create(){let t=this.date.clone().startOf(ne);return(0,j.createYearlyNote)(t)}getAllPaths(){let t=(0,j.getAllYearlyNotes)();return Object.entries(t).map(([e,n])=>n.path)}getCurrent(){return(0,j.getYearlyNote)(this.date,(0,j.getAllYearlyNotes)())}getNextDate(){return this.getDate().clone().add(1,ne)}getPrevious(){let t=this.getDate().clone().subtract(1,ne),e=t.clone().subtract(Pn,ne),n=(0,j.getAllYearlyNotes)(),i;do i=(0,j.getYearlyNote)(t,n),t.subtract(1,ne);while(!i&&t.isAfter(e));return i}isPresent(){let t=this.date.clone().startOf(ne),e=(0,j.getAllYearlyNotes)();return!!(0,j.getYearlyNote)(t,e)}isValid(t){let e=(0,j.getYearlyNote)(this.getDate(),(0,j.getAllYearlyNotes)());return e?e.name===t.name&&re(e):!1}},at=class{convertSettings(t){let e=t,n=Object.assign({},Ee);return n.daily.available=e.daily.enabled,n.weekly.available=e.weekly.enabled,n.monthly.available=e.monthly.enabled,n.quarterly.available=e.quarterly.enabled,n.yearly.available=e.yearly.enabled,n}};function ot(){}function rt(t){return t()}function lt(t){t.forEach(rt)}function kn(t){return typeof t=="function"}function An(t){return Object.keys(t).length===0}function On(t,...e){if(t==null)return ot;let n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Sn(t){let e;return On(t,n=>e=n)(),e}var oi=Promise.resolve(),ri=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function Fn(t,e){let n=t.$$;n.fragment!==null&&(lt(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}var Cn;typeof HTMLElement=="function"&&(Cn=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){let{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(rt).filter(kn);for(let e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){lt(this.$$.on_disconnect)}$destroy(){Fn(this,1),this.$destroy=ot}$on(t,e){let n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{let i=n.indexOf(e);i!==-1&&n.splice(i,1)}}$set(t){this.$$set&&!An(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});var st=class{convertSettings(t){var e,n,i,a,o;let s=Sn(t),d=s.calendarSets.filter(p=>p.id===s.activeCalendarSet),g=Object.assign({},Ee);return g.daily.available=!1,g.weekly.available=!1,g.monthly.available=!1,g.quarterly.available=!1,g.yearly.available=!1,d.length&&(g.daily.available=((e=d[0].day)==null?void 0:e.enabled)||!1,g.weekly.available=((n=d[0].week)==null?void 0:n.enabled)||!1,g.monthly.available=((i=d[0].month)==null?void 0:i.enabled)||!1,g.quarterly.available=((a=d[0].quarter)==null?void 0:a.enabled)||!1,g.yearly.available=((o=d[0].year)==null?void 0:o.enabled)||!1),g}},En=class{constructor(t){this.app=t}getProvider(){return this.getPlugin().settings.daily!==void 0?new at:new st}getPlugin(){return this.app.plugins.getPlugin(Ce)}isEnabled(){return this.app.plugins.enabledPlugins.has(Ce)}convertSettings(){return this.getProvider().convertSettings(this.getPlugin().settings)}},In="periodic-notes:settings-updated",Ce="periodic-notes",Ee={daily:{available:!1},weekly:{available:!1},monthly:{available:!1},quarterly:{available:!1},yearly:{available:!1}}});var At=Ge(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});var S=require("obsidian"),Le="YYYY-MM-DD",$e="gggg-[W]ww",gt="YYYY-MM",mt="YYYY-[Q]Q",ht="YYYY";function pe(t){var n,i;let e=window.app.plugins.getPlugin("periodic-notes");return e&&((i=(n=e.settings)==null?void 0:n[t])==null?void 0:i.enabled)}function ge(){var t,e,n,i;try{let{internalPlugins:a,plugins:o}=window.app;if(pe("daily")){let{format:p,folder:N,template:v}=((e=(t=o.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.daily)||{};return{format:p||Le,folder:(N==null?void 0:N.trim())||"",template:(v==null?void 0:v.trim())||""}}let{folder:s,format:d,template:g}=((i=(n=a.getPluginById("daily-notes"))==null?void 0:n.instance)==null?void 0:i.options)||{};return{format:d||Le,folder:(s==null?void 0:s.trim())||"",template:(g==null?void 0:g.trim())||""}}catch(a){console.info("No custom daily note settings found!",a)}}function me(){var t,e,n,i,a,o,s;try{let d=window.app.plugins,g=(t=d.getPlugin("calendar"))==null?void 0:t.options,p=(n=(e=d.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:n.weekly;if(pe("weekly"))return{format:p.format||$e,folder:((i=p.folder)==null?void 0:i.trim())||"",template:((a=p.template)==null?void 0:a.trim())||""};let N=g||{};return{format:N.weeklyNoteFormat||$e,folder:((o=N.weeklyNoteFolder)==null?void 0:o.trim())||"",template:((s=N.weeklyNoteTemplate)==null?void 0:s.trim())||""}}catch(d){console.info("No custom weekly note settings found!",d)}}function he(){var e,n,i,a;let t=window.app.plugins;try{let o=pe("monthly")&&((n=(e=t.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:n.monthly)||{};return{format:o.format||gt,folder:((i=o.folder)==null?void 0:i.trim())||"",template:((a=o.template)==null?void 0:a.trim())||""}}catch(o){console.info("No custom monthly note settings found!",o)}}function fe(){var e,n,i,a;let t=window.app.plugins;try{let o=pe("quarterly")&&((n=(e=t.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:n.quarterly)||{};return{format:o.format||mt,folder:((i=o.folder)==null?void 0:i.trim())||"",template:((a=o.template)==null?void 0:a.trim())||""}}catch(o){console.info("No custom quarterly note settings found!",o)}}function ye(){var e,n,i,a;let t=window.app.plugins;try{let o=pe("yearly")&&((n=(e=t.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:n.yearly)||{};return{format:o.format||ht,folder:((i=o.folder)==null?void 0:i.trim())||"",template:((a=o.template)==null?void 0:a.trim())||""}}catch(o){console.info("No custom yearly note settings found!",o)}}function ft(...t){let e=[];for(let i=0,a=t.length;i<a;i++)e=e.concat(t[i].split("/"));let n=[];for(let i=0,a=e.length;i<a;i++){let o=e[i];!o||o==="."||n.push(o)}return e[0]===""&&n.unshift(""),n.join("/")}function Ln(t){let e=t.substring(t.lastIndexOf("/")+1);return e.lastIndexOf(".")!=-1&&(e=e.substring(0,e.lastIndexOf("."))),e}async function $n(t){let e=t.replace(/\\/g,"/").split("/");if(e.pop(),e.length){let n=ft(...e);window.app.vault.getAbstractFileByPath(n)||await window.app.vault.createFolder(n)}}async function we(t,e){e.endsWith(".md")||(e+=".md");let n=S.normalizePath(ft(t,e));return await $n(n),n}async function le(t){let{metadataCache:e,vault:n}=window.app,i=S.normalizePath(t);if(i==="/")return Promise.resolve(["",null]);try{let a=e.getFirstLinkpathDest(i,""),o=await n.cachedRead(a),s=window.app.foldManager.load(a);return[o,s]}catch(a){return console.error(`Failed to read the daily note template '${i}'`,a),new S.Notice("Failed to read the daily note template"),["",null]}}function x(t,e="day"){let n=t.clone().startOf(e).format();return`${e}-${n}`}function yt(t){return t.replace(/\[[^\]]*\]/g,"")}function Mn(t,e){if(e==="week"){let n=yt(t);return/w{1,2}/i.test(n)&&(/M{1,4}/.test(n)||/D{1,4}/.test(n))}return!1}function se(t,e){return wt(t.basename,e)}function Yn(t,e){return wt(Ln(t),e)}function wt(t,e){let i={day:ge,week:me,month:he,quarter:fe,year:ye}[e]().format.split("/").pop(),a=window.moment(t,i,!0);if(!a.isValid())return null;if(Mn(i,e)&&e==="week"){let o=yt(i);if(/w{1,2}/i.test(o))return window.moment(t,i.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return a}var Me=class extends Error{};async function Nt(t){let e=window.app,{vault:n}=e,i=window.moment,{template:a,format:o,folder:s}=ge(),[d,g]=await le(a),p=t.format(o),N=await we(s,p);try{let v=await n.create(N,d.replace(/{{\s*date\s*}}/gi,p).replace(/{{\s*time\s*}}/gi,i().format("HH:mm")).replace(/{{\s*title\s*}}/gi,p).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(y,A,F,D,P,b)=>{let C=i(),G=t.clone().set({hour:C.get("hour"),minute:C.get("minute"),second:C.get("second")});return F&&G.add(parseInt(D,10),P),b?G.format(b.substring(1).trim()):G.format(o)}).replace(/{{\s*yesterday\s*}}/gi,t.clone().subtract(1,"day").format(o)).replace(/{{\s*tomorrow\s*}}/gi,t.clone().add(1,"d").format(o)));return e.foldManager.save(v,g),v}catch(v){console.error(`Failed to create file: '${N}'`,v),new S.Notice("Unable to create new file.")}}function xn(t,e){var n;return(n=e[x(t,"day")])!=null?n:null}function Wn(){let{vault:t}=window.app,{folder:e}=ge(),n=t.getAbstractFileByPath(S.normalizePath(e));if(!n)throw new Me("Failed to find daily notes folder");let i={};return S.Vault.recurseChildren(n,a=>{if(a instanceof S.TFile){let o=se(a,"day");if(o){let s=x(o,"day");i[s]=a}}}),i}var Ye=class extends Error{};function qn(){let{moment:t}=window,e=t.localeData()._week.dow,n=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;e;)n.push(n.shift()),e--;return n}function Un(t){return qn().indexOf(t.toLowerCase())}async function vt(t){let{vault:e}=window.app,{template:n,format:i,folder:a}=me(),[o,s]=await le(n),d=t.format(i),g=await we(a,d);try{let p=await e.create(g,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(N,v,y,A,F,D)=>{let P=window.moment(),b=t.clone().set({hour:P.get("hour"),minute:P.get("minute"),second:P.get("second")});return y&&b.add(parseInt(A,10),F),D?b.format(D.substring(1).trim()):b.format(i)}).replace(/{{\s*title\s*}}/gi,d).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(N,v,y)=>{let A=Un(v);return t.weekday(A).format(y.trim())}));return window.app.foldManager.save(p,s),p}catch(p){console.error(`Failed to create file: '${g}'`,p),new S.Notice("Unable to create new file.")}}function Hn(t,e){var n;return(n=e[x(t,"week")])!=null?n:null}function Rn(){let t={};if(!Tt())return t;let{vault:e}=window.app,{folder:n}=me(),i=e.getAbstractFileByPath(S.normalizePath(n));if(!i)throw new Ye("Failed to find weekly notes folder");return S.Vault.recurseChildren(i,a=>{if(a instanceof S.TFile){let o=se(a,"week");if(o){let s=x(o,"week");t[s]=a}}}),t}var xe=class extends Error{};async function bt(t){let{vault:e}=window.app,{template:n,format:i,folder:a}=he(),[o,s]=await le(n),d=t.format(i),g=await we(a,d);try{let p=await e.create(g,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(N,v,y,A,F,D)=>{let P=window.moment(),b=t.clone().set({hour:P.get("hour"),minute:P.get("minute"),second:P.get("second")});return y&&b.add(parseInt(A,10),F),D?b.format(D.substring(1).trim()):b.format(i)}).replace(/{{\s*date\s*}}/gi,d).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,d));return window.app.foldManager.save(p,s),p}catch(p){console.error(`Failed to create file: '${g}'`,p),new S.Notice("Unable to create new file.")}}function Vn(t,e){var n;return(n=e[x(t,"month")])!=null?n:null}function Qn(){let t={};if(!Pt())return t;let{vault:e}=window.app,{folder:n}=he(),i=e.getAbstractFileByPath(S.normalizePath(n));if(!i)throw new xe("Failed to find monthly notes folder");return S.Vault.recurseChildren(i,a=>{if(a instanceof S.TFile){let o=se(a,"month");if(o){let s=x(o,"month");t[s]=a}}}),t}var We=class extends Error{};async function jn(t){let{vault:e}=window.app,{template:n,format:i,folder:a}=fe(),[o,s]=await le(n),d=t.format(i),g=await we(a,d);try{let p=await e.create(g,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(N,v,y,A,F,D)=>{let P=window.moment(),b=t.clone().set({hour:P.get("hour"),minute:P.get("minute"),second:P.get("second")});return y&&b.add(parseInt(A,10),F),D?b.format(D.substring(1).trim()):b.format(i)}).replace(/{{\s*date\s*}}/gi,d).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,d));return window.app.foldManager.save(p,s),p}catch(p){console.error(`Failed to create file: '${g}'`,p),new S.Notice("Unable to create new file.")}}function zn(t,e){var n;return(n=e[x(t,"quarter")])!=null?n:null}function Bn(){let t={};if(!Dt())return t;let{vault:e}=window.app,{folder:n}=fe(),i=e.getAbstractFileByPath(S.normalizePath(n));if(!i)throw new We("Failed to find quarterly notes folder");return S.Vault.recurseChildren(i,a=>{if(a instanceof S.TFile){let o=se(a,"quarter");if(o){let s=x(o,"quarter");t[s]=a}}}),t}var qe=class extends Error{};async function Gn(t){let{vault:e}=window.app,{template:n,format:i,folder:a}=ye(),[o,s]=await le(n),d=t.format(i),g=await we(a,d);try{let p=await e.create(g,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(N,v,y,A,F,D)=>{let P=window.moment(),b=t.clone().set({hour:P.get("hour"),minute:P.get("minute"),second:P.get("second")});return y&&b.add(parseInt(A,10),F),D?b.format(D.substring(1).trim()):b.format(i)}).replace(/{{\s*date\s*}}/gi,d).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,d));return window.app.foldManager.save(p,s),p}catch(p){console.error(`Failed to create file: '${g}'`,p),new S.Notice("Unable to create new file.")}}function Jn(t,e){var n;return(n=e[x(t,"year")])!=null?n:null}function Kn(){let t={};if(!kt())return t;let{vault:e}=window.app,{folder:n}=ye(),i=e.getAbstractFileByPath(S.normalizePath(n));if(!i)throw new qe("Failed to find yearly notes folder");return S.Vault.recurseChildren(i,a=>{if(a instanceof S.TFile){let o=se(a,"year");if(o){let s=x(o,"year");t[s]=a}}}),t}function Xn(){var i,a;let{app:t}=window,e=t.internalPlugins.plugins["daily-notes"];if(e&&e.enabled)return!0;let n=t.plugins.getPlugin("periodic-notes");return n&&((a=(i=n.settings)==null?void 0:i.daily)==null?void 0:a.enabled)}function Tt(){var n,i;let{app:t}=window;if(t.plugins.getPlugin("calendar"))return!0;let e=t.plugins.getPlugin("periodic-notes");return e&&((i=(n=e.settings)==null?void 0:n.weekly)==null?void 0:i.enabled)}function Pt(){var n,i;let{app:t}=window,e=t.plugins.getPlugin("periodic-notes");return e&&((i=(n=e.settings)==null?void 0:n.monthly)==null?void 0:i.enabled)}function Dt(){var n,i;let{app:t}=window,e=t.plugins.getPlugin("periodic-notes");return e&&((i=(n=e.settings)==null?void 0:n.quarterly)==null?void 0:i.enabled)}function kt(){var n,i;let{app:t}=window,e=t.plugins.getPlugin("periodic-notes");return e&&((i=(n=e.settings)==null?void 0:n.yearly)==null?void 0:i.enabled)}function Zn(t){let e={day:ge,week:me,month:he,quarter:fe,year:ye}[t];return e()}function ei(t,e){return{day:Nt,month:bt,week:vt}[t](e)}w.DEFAULT_DAILY_NOTE_FORMAT=Le;w.DEFAULT_MONTHLY_NOTE_FORMAT=gt;w.DEFAULT_QUARTERLY_NOTE_FORMAT=mt;w.DEFAULT_WEEKLY_NOTE_FORMAT=$e;w.DEFAULT_YEARLY_NOTE_FORMAT=ht;w.appHasDailyNotesPluginLoaded=Xn;w.appHasMonthlyNotesPluginLoaded=Pt;w.appHasQuarterlyNotesPluginLoaded=Dt;w.appHasWeeklyNotesPluginLoaded=Tt;w.appHasYearlyNotesPluginLoaded=kt;w.createDailyNote=Nt;w.createMonthlyNote=bt;w.createPeriodicNote=ei;w.createQuarterlyNote=jn;w.createWeeklyNote=vt;w.createYearlyNote=Gn;w.getAllDailyNotes=Wn;w.getAllMonthlyNotes=Qn;w.getAllQuarterlyNotes=Bn;w.getAllWeeklyNotes=Rn;w.getAllYearlyNotes=Kn;w.getDailyNote=xn;w.getDailyNoteSettings=ge;w.getDateFromFile=se;w.getDateFromPath=Yn;w.getDateUID=x;w.getMonthlyNote=Vn;w.getMonthlyNoteSettings=he;w.getPeriodicNoteSettings=Zn;w.getQuarterlyNote=zn;w.getQuarterlyNoteSettings=fe;w.getTemplateInfo=le;w.getWeeklyNote=Hn;w.getWeeklyNoteSettings=me;w.getYearlyNote=Jn;w.getYearlyNoteSettings=ye});var ii={};an(ii,{default:()=>Ae});module.exports=on(ii);var W=require("obsidian"),Oe=Pe(Ie());function dt(t,e){let n=Object.keys(e).map(i=>_n(t,i,e[i]));return n.length===1?n[0]:function(){n.forEach(i=>i())}}function _n(t,e,n){let i=t[e],a=t.hasOwnProperty(e),o=a?i:function(){return Object.getPrototypeOf(t)[e].apply(this,arguments)},s=n(o);return i&&Object.setPrototypeOf(s,i),Object.setPrototypeOf(d,s),t[e]=d,g;function d(...p){return s===o&&t[e]===d&&g(),s.apply(this,p)}function g(){t[e]===d&&(a?t[e]=o:delete t[e]),s!==o&&(s=o,Object.setPrototypeOf(d,i||Function))}}var St=Pe(require("os"));var ut="auto-periodic-notes:settings-updated";var pt=!1;function _e(t){pt=t}function f(t){pt&&console.log(`[Auto Periodic Notes] ${t}`)}var ie=require("obsidian");var z=Pe(Ie()),B=Pe(At());function ti(t){var n;let e=t.plugins;return((n=e==null?void 0:e.plugins)==null?void 0:n["templater-obsidian"])||null}async function ke(t,e,n=!1){var a;let i=ti(t);if(!i){f("Templater plugin not found or not enabled");return}if(n||!((a=i==null?void 0:i.settings)!=null&&a.trigger_on_file_creation)){f(`Processing Templater commands in file: ${e.path}`);try{await new Promise(g=>setTimeout(g,500));let o=t.workspace.getActiveFile(),s=(o==null?void 0:o.path)===e.path,d=null;s||(d=t.workspace.getLeaf("tab"),await d.openFile(e),await new Promise(g=>setTimeout(g,200))),await i.templater.overwrite_active_file_commands(),await new Promise(g=>setTimeout(g,300)),d&&!s&&d.detach(),f("Templater processing completed successfully")}catch(o){f(`Error processing Templater commands: ${o}`)}}else f("Skipping Templater processing - trigger_on_file_creation is enabled")}var ni=1e3,Ne=class{constructor(e,n,i,a){this.workspace=e,this.app=n,this.plugin=i,this.waitTimeout=a||ni}async checkAndCreateNotes(e,n){f(`Checking if any new notes need to be created (context: ${(n==null?void 0:n.scheduleName)||"manual"})`),await this.checkAndCreateSingleNote(e.yearly,new z.YearlyNote,"yearly",e.alwaysOpen,e.processTemplater,n),await this.checkAndCreateSingleNote(e.quarterly,new z.QuarterlyNote,"quarterly",e.alwaysOpen,e.processTemplater,n),await this.checkAndCreateSingleNote(e.monthly,new z.MonthlyNote,"monthly",e.alwaysOpen,e.processTemplater,n),await this.checkAndCreateSingleNote(e.weekly,new z.WeeklyNote,"weekly",e.alwaysOpen,e.processTemplater,n),await this.checkAndCreateSingleNote(e.daily,new z.DailyNote,"daily",e.alwaysOpen,e.processTemplater,n)}async checkAndCreateSingleNote(e,n,i,a,o,s){var d,g;if(e.available&&e.enabled)if(this.workspaceLeaves={},f(`Checking if ${i} note needs to be created`),i==="daily"){let p=e,N=(s==null?void 0:s.scheduleName)==="customScheduledTime";if(N||p.createTomorrowsNote||p.unpinOldDailyNotes){let y=(0,ie.moment)();if(N&&p.createTomorrowsNote){if(y=y.add(1,"day"),p.excludeWeekends)for(;y.format("dd")==="Sa"||y.format("dd")==="Su";)y=y.add(1,"day");f(`Target date for custom scheduled time: ${y.format("YYYY-MM-DD")}`)}else if(p.excludeWeekends){let D=y.format("dd");if(D==="Sa"||D==="Su"){f("Not creating new note as it is a weekend");return}}let A=(0,B.getAllDailyNotes)(),F=(0,B.getDailyNote)(y,A);if(!F){let D=(0,B.getDailyNoteSettings)(),P=D.format||B.DEFAULT_DAILY_NOTE_FORMAT,b=((d=D.folder)==null?void 0:d.trim())||"",C=y.format(P),G=b?`${b}/${C}.md`:`${C}.md`,ae=this.app.vault.getAbstractFileByPath(G);ae&&"path"in ae&&((g=ae.path)!=null&&g.endsWith(".md"))&&(f(`Note not in cache but exists in filesystem: ${G}`),F=ae)}if(F){let P=((s==null?void 0:s.scheduleName)==="mainDailyCheck"||(s==null?void 0:s.scheduleName)==="startup")&&e.closeExisting,b=N&&p.unpinOldDailyNotes;(a||P||b||N)&&(f(`Daily note exists for ${y.format("YYYY-MM-DD")}, handling existing tabs`),b?await this.handleUnpin(e,n,F):P&&await this.handleClose(e,n,F),await this.handleOpen(e,F,i))}else{f(`Creating daily note for ${y.format("YYYY-MM-DD")}`);let D=await(0,B.createDailyNote)(y);new ie.Notice(N&&p.createTomorrowsNote?"Tomorrow's daily note has been created.":"Today's daily note has been created.",5e3),N&&p.unpinOldDailyNotes?await this.handleUnpin(e,n,D):await this.handleClose(e,n,D),await this.handleOpen(e,D,i),o&&await ke(this.app,D,!0)}}else if(n.isPresent()){if(a){f(`Set to always open notes, getting current ${i} note`);let y=n.getCurrent();await this.handleClose(e,n,y),await this.handleOpen(e,y,i)}}else{if(p.excludeWeekends){let A=(0,ie.moment)();if(A.format("dd")==="Sa"||A.format("dd")==="Su"){f("Not creating new note as it is a weekend");return}}f(`Creating new ${i} note`);let y=await n.create();new ie.Notice(`Today's ${i} note has been created.`,5e3),await this.handleClose(e,n,y),await this.handleOpen(e,y,i),o&&await ke(this.app,y,!0)}}else if(n.isPresent()){if(a){f(`Set to always open notes, getting current ${i} note`);let p=n.getCurrent();await this.handleClose(e,n,p),await this.handleOpen(e,p,i)}}else{f(`Creating new ${i} note`);let p=await n.create();new ie.Notice(`Today's ${i} note has been created.`,5e3),await this.handleClose(e,n,p),await this.handleOpen(e,p,i),o&&await ke(this.app,p,!0)}}getOpenWorkspaceLeaves(){return Object.keys(this.workspaceLeaves).length||(this.workspace.iterateAllLeaves(e=>{var a,o,s,d;let n=(o=(a=e.view)==null?void 0:a.getViewType)==null?void 0:o.call(a),i=(d=(s=e.view)==null?void 0:s.getState)==null?void 0:d.call(s);f(`Leaf found - viewType: ${n}, state.file: ${i==null?void 0:i.file}`),(n==="markdown"||n===void 0)&&i&&typeof i.file!="undefined"&&(this.workspaceLeaves[i.file]=e)}),f(`Found ${Object.keys(this.workspaceLeaves).length} actual file tabs open: ${Object.keys(this.workspaceLeaves).join(", ")}`)),this.workspaceLeaves}async handleClose(e,n,i){if(e.closeExisting){f("Checking for any existing notes to close");let a=n.getAllPaths(),o=[];Object.entries(this.getOpenWorkspaceLeaves()).forEach(([s,d])=>{a.indexOf(s)>-1&&s!==i.path&&o.push(d)}),f("Found "+o.length+" tab(s) to close");for(let s of o)s.detach();await new Promise(s=>setTimeout(s,this.waitTimeout))}}async handleUnpin(e,n,i){if(e.unpinOldDailyNotes){f("Unpinning all old daily notes");let o=n.getAllPaths(),s=[];Object.entries(this.getOpenWorkspaceLeaves()).forEach(([d,g])=>{o.indexOf(d)>-1&&d!==i.path&&s.push(g)}),f(`Found ${s.length} daily note tab(s) to unpin`);for(let d of s)d.setPinned(!1)}}async handleOpen(e,n,i){var s,d,g,p;let a=this.getOpenWorkspaceLeaves(),o=Object.keys(a).indexOf(n.path)!==-1;if(f(`handleOpen called: openAndPin=${e.openAndPin}, notePath=${n.path}, isAlreadyOpen=${o}, openLeavesCount=${Object.keys(a).length}`),e.openAndPin&&!o){f("Opening note in new tab");let N=i==="daily"&&"openAtFirstPosition"in e&&e.openAtFirstPosition,v;if(N){this.plugin.setDailyNoteCreation(!0);try{v=this.workspace.getLeaf("tab"),f("Used monkey patch to create daily note leaf at first position")}finally{this.plugin.setDailyNoteCreation(!1)}}else v=this.workspace.getLeaf(!0);if(await v.openFile(n),f(`Before setPinned - leaf parent has ${((d=(s=v.parent)==null?void 0:s.children)==null?void 0:d.length)||0} children`),v.setPinned(!0),f(`After setPinned - leaf parent has ${((p=(g=v.parent)==null?void 0:g.children)==null?void 0:p.length)||0} children`),N){let y=v.parent;if(y&&y.children){let A=y.children.indexOf(v);f(`Daily note leaf is at index ${A} after pinning, moving to index 0`),A>0&&(y.children.splice(A,1),y.children.unshift(v),y.recomputeChildrenDimensions(),f("Moved daily note leaf to first position"))}}}}isEmptyLeaf(e){let n=e.view.getViewType();return["empty","home-tab-view"].includes(n)}};var ve=Object.freeze({available:!1,enabled:!1,closeExisting:!1,openAndPin:!1}),K=Object.freeze({alwaysOpen:!1,processTemplater:!1,debug:!1,daily:{...ve,excludeWeekends:!1,openAtFirstPosition:!1,enableAdvancedScheduling:!1,scheduledTime:"22:00",createTomorrowsNote:!1,unpinOldDailyNotes:!1},weekly:{...ve},monthly:{...ve},quarterly:{...ve},yearly:{...ve},deviceSettings:{}});function Ot(t){var n,i,a,o;return{alwaysOpen:(n=t==null?void 0:t.alwaysOpen)!=null?n:K.alwaysOpen,processTemplater:(i=t==null?void 0:t.processTemplater)!=null?i:K.processTemplater,debug:(a=t==null?void 0:t.debug)!=null?a:K.debug,daily:{...K.daily,...t==null?void 0:t.daily},weekly:{...K.weekly,...t==null?void 0:t.weekly},monthly:{...K.monthly,...t==null?void 0:t.monthly},quarterly:{...K.quarterly,...t==null?void 0:t.quarterly},yearly:{...K.yearly,...t==null?void 0:t.yearly},deviceSettings:(o=t==null?void 0:t.deviceSettings)!=null?o:{}}}var _=require("obsidian"),be=class extends _.PluginSettingTab{constructor(e,n){super(e,n),this.plugin=n}display(){var a,o;this.containerEl.empty();let e=this.plugin.settings,n=["daily","weekly","monthly","quarterly","yearly"];if(!e.daily.available&&!e.weekly.available&&!e.monthly.available&&!e.quarterly.available&&!e.yearly.available){let s=this.containerEl.createDiv({cls:"settings-banner"});new _.Setting(s).setName("No periodic notes enabled").setHeading().setDesc("No periodic notes settings are enabled. You must turn on one of daily, weekly, monthly, quarterly or yearly notes within the Periodic Notes plugin settings to be able to configure them to generate automatically.")}this.containerEl.createEl("h3",{text:"General settings"}),new _.Setting(this.containerEl).setName("Enable debug logging").setDesc("Enable detailed debug logging in the developer console.").addToggle(s=>{s.setValue(e.debug).onChange(async d=>{e.debug=d,await this.plugin.updateSettings(e)})}),new _.Setting(this.containerEl).setName("Always open periodic notes").setDesc("Always open your periodic notes even when they haven't just been created.").addToggle(s=>{s.setValue(e.alwaysOpen).onChange(async d=>{e.alwaysOpen=d,await this.plugin.updateSettings(e)})}),!!((o=(a=this.app.plugins)==null?void 0:a.plugins)!=null&&o["templater-obsidian"])&&new _.Setting(this.containerEl).setName("Process Templater code in automatically created notes").setDesc("Automatically process Templater syntax from notes created in the background.").addToggle(s=>{s.setValue(e.processTemplater).onChange(async d=>{e.processTemplater=d,await this.plugin.updateSettings(e)})});for(let s of n)e[s].available&&this.renderPeriodicitySection(s,e)}renderPeriodicitySection(e,n){let i=e==="daily";this.containerEl.createEl("h3",{text:`Automatic ${e} notes`}),new _.Setting(this.containerEl).setName(`Enable automatic ${e} notes`).setDesc(`Create new ${e} notes automatically using periodic notes location and template.`).addToggle(a=>{a.setValue(n[e].enabled).onChange(async o=>{n[e].enabled=o,await this.plugin.updateSettings(n)})}),i&&new _.Setting(this.containerEl).setName("Exclude weekends").setDesc("Skip creating daily notes on Saturdays and Sundays.").addToggle(a=>{a.setValue(n.daily.excludeWeekends).onChange(async o=>{n.daily.excludeWeekends=o,await this.plugin.updateSettings(n)})}),new _.Setting(this.containerEl).setName(`Open and pin new ${e} notes`).setDesc("Automatically open and pin the new note to your tabs.").addToggle(a=>{a.setValue(n[e].openAndPin).onChange(async o=>{n[e].openAndPin=o,await this.plugin.updateSettings(n)})}),i&&new _.Setting(this.containerEl).setName("Open daily notes at first position").setDesc("Position new daily note tabs at the first position.").addToggle(a=>{a.setValue(n.daily.openAtFirstPosition).onChange(async o=>{n.daily.openAtFirstPosition=o,await this.plugin.updateSettings(n)})}),new _.Setting(this.containerEl).setName(`Close older ${e} notes`).setDesc(i?"Close older open daily notes at 00:02 or on startup (not at custom scheduled time).":`Automatically close any older open ${e} notes.`).addToggle(a=>{a.setValue(n[e].closeExisting).onChange(async o=>{n[e].closeExisting=o,await this.plugin.updateSettings(n)})}),i&&this.renderDailyAdvancedSection(n)}renderDailyAdvancedSection(e){let n=this.containerEl.createEl("details",{cls:"setting-item-details"});n.createEl("summary",{text:"Advanced: Custom Scheduled Time",cls:"setting-item-heading"});let i=n.createDiv({cls:"setting-item-details-content"});if(new _.Setting(i).setName("Enable custom scheduled time").setDesc("Schedule an additional daily check at a custom time (e.g., 22:30 to create tomorrow's note before sleep).").addToggle(a=>{a.setValue(e.daily.enableAdvancedScheduling).onChange(async o=>{e.daily.enableAdvancedScheduling=o,await this.plugin.updateSettings(e),this.display()})}),e.daily.enableAdvancedScheduling){let a=this.plugin.getDeviceId(),o=this.plugin.getDeviceScheduledTime();new _.Setting(i).setName(`Scheduled time (${a})`).setDesc("Time for the custom check (24-hour format). This setting is device-specific and will not affect other devices.").addText(s=>{s.setPlaceholder("HH:mm (e.g., 22:30)").setValue(o).onChange(async d=>{/^([01]\d|2[0-3]):([0-5]\d)$/.test(d)||d===""?await this.plugin.setDeviceScheduledTime(d||"22:00"):new _.Notice("Invalid time format. Use HH:mm (e.g., 22:30)")})}),new _.Setting(i).setName("Create tomorrow's daily note").setDesc("At the custom scheduled time, create tomorrow's note instead of today's.").addToggle(s=>{s.setValue(e.daily.createTomorrowsNote).onChange(async d=>{e.daily.createTomorrowsNote=d,await this.plugin.updateSettings(e)})}),new _.Setting(i).setName("Unpin old daily notes").setDesc("At the custom scheduled time, unpin old daily notes instead of closing them.").addToggle(s=>{s.setValue(e.daily.unpinOldDailyNotes).onChange(async d=>{e.daily.unpinOldDailyNotes=d,await this.plugin.updateSettings(e)})})}}};var Ae=class extends W.Plugin{constructor(n,i){super(n,i);this.isDailyNoteCreation=!1;this.scheduledTimeouts={mainDailyCheck:null,customScheduledTime:null};this.settings={},this.periodicNotesPlugin=new Oe.PeriodicNotesPluginAdapter(n),this.notes=new Ne(n.workspace,n,this)}async onload(){this.updateSettings=this.updateSettings.bind(this),await this.loadSettings(),this.setupWorkspacePatches(),this.app.workspace.onLayoutReady(this.onLayoutReady.bind(this))}onLayoutReady(){if(!this.periodicNotesPlugin.isEnabled()){new W.Notice("The Periodic Notes plugin must be installed and available for Auto Periodic Notes to work.",1e4);return}let n=this.app.workspace;this.registerEvent(n.on(Oe.PERIODIC_NOTES_EVENT_SETTING_UPDATED,this.syncPeriodicNotesSettings.bind(this))),this.syncPeriodicNotesSettings(),this.addSettingTab(new be(this.app,this)),this.notes.checkAndCreateNotes(this.settings,{scheduleName:"startup"}).catch(i=>{f(`Error during startup check: ${i.message}`),console.error("Auto Periodic Notes: Failed to create notes on startup",i),new W.Notice("Auto Periodic Notes: Failed to create notes on startup. Check console for details.")}),this.scheduleAllDailyChecks(),this.register(this.clearAllScheduledTimeouts.bind(this))}async loadSettings(){this.settings=Ot(await this.loadData()),_e(this.settings.debug),f("Loaded settings: "+JSON.stringify(this.settings))}async updateSettings(n){this.settings=n,_e(this.settings.debug),await this.saveData(this.settings),this.onSettingsUpdate(),this.scheduleCustomScheduledTime(),f("Saved settings: "+JSON.stringify(this.settings))}syncPeriodicNotesSettings(){f("Received new settings from Periodic Notes plugin");let n=this.periodicNotesPlugin.convertSettings();this.settings.daily.available=n.daily.available,this.settings.weekly.available=n.weekly.available,this.settings.monthly.available=n.monthly.available,this.settings.quarterly.available=n.quarterly.available,this.settings.yearly.available=n.yearly.available,this.updateSettings(this.settings)}onSettingsUpdate(){this.app.workspace.trigger(ut)}setupWorkspacePatches(){let n=this;this.monkeyPatchCleanup=dt(W.Workspace.prototype,{getLeaf:i=>function(a){return n.isDailyNoteCreation&&n.settings.daily.openAtFirstPosition?(f("Intercepted getLeaf call for daily note - creating at first position"),n.createLeafAtFirstPosition()):i.call(this,a)}}),this.register(()=>{this.monkeyPatchCleanup&&(this.monkeyPatchCleanup(),f("Cleaned up monkey patch"))})}createLeafAtFirstPosition(){let n=this.app.workspace.getMostRecentLeaf();if(!n){let o=this.isDailyNoteCreation;this.isDailyNoteCreation=!1;let s=this.app.workspace.getLeaf("tab");return this.isDailyNoteCreation=o,s}let i=n.parent,a=i.children;if(a&&a.length>0){let o=a[0],s=o.view.getViewType();if(["empty","home-tab-view"].includes(s))return f("Reusing empty leaf at first position"),o}try{let o=new W.WorkspaceLeaf(this.app);return i.insertChild(0,o),f("Created new leaf at first position via monkey patch"),o}catch(o){f("Failed to create leaf at first position, using fallback: "+o);let s=this.isDailyNoteCreation;this.isDailyNoteCreation=!1;let d=this.app.workspace.getLeaf("tab");return this.isDailyNoteCreation=s,d}}setDailyNoteCreation(n){this.isDailyNoteCreation=n}getDeviceId(){return St.hostname()}getDeviceScheduledTime(){var i,a,o,s;let n=this.getDeviceId();return(s=(o=(a=(i=this.settings.deviceSettings)==null?void 0:i[n])==null?void 0:a.scheduledTime)!=null?o:this.settings.daily.scheduledTime)!=null?s:""}async setDeviceScheduledTime(n){let i=this.getDeviceId();this.settings.deviceSettings||(this.settings.deviceSettings={}),this.settings.deviceSettings[i]||(this.settings.deviceSettings[i]={scheduledTime:""}),this.settings.deviceSettings[i].scheduledTime=n,await this.saveData(this.settings),f(`Device ${i} scheduled time changed to ${n}, rescheduling...`),this.scheduleCustomScheduledTime()}scheduleMainDailyCheck(){this.clearScheduledTimeout("mainDailyCheck");let n=new Date,i=new Date(n);i.setHours(0,2,0,0),i<=n&&i.setDate(i.getDate()+1);let a=i.getTime()-n.getTime();f(`[mainDailyCheck] Scheduled for ${i.toISOString()} (in ${a}ms)`),this.scheduledTimeouts.mainDailyCheck=window.setTimeout(async()=>{try{await this.notes.checkAndCreateNotes(this.settings,{scheduleName:"mainDailyCheck"})}catch(o){f(`Error in mainDailyCheck: ${o.message}`),console.error("Auto Periodic Notes: Failed during main daily check",o),new W.Notice("Auto Periodic Notes: Failed to create daily notes. Check console for details.")}finally{this.scheduleMainDailyCheck()}},a)}scheduleCustomScheduledTime(){let n=this.settings.daily,i=this.getDeviceScheduledTime(),a=this.getDeviceId();if(f(`[customScheduledTime] Checking settings for device ${a}: enableAdvancedScheduling=${n.enableAdvancedScheduling}, scheduledTime=${i}`),!n.enableAdvancedScheduling||!i){f("[customScheduledTime] Not scheduling - conditions not met"),this.clearScheduledTimeout("customScheduledTime");return}if(i==="00:02"){f("[customScheduledTime] Not scheduling - conflicts with main daily check at 00:02"),this.clearScheduledTimeout("customScheduledTime");return}if(!/^([01]\d|2[0-3]):([0-5]\d)$/.test(i)){f(`[customScheduledTime] Not scheduling - invalid time format: ${i}`),this.clearScheduledTimeout("customScheduledTime");return}this.clearScheduledTimeout("customScheduledTime");let s=new Date,d=new Date(s),[g,p]=this.parseScheduledTime(i);d.setHours(g,p,0,0),d<=s&&d.setDate(d.getDate()+1);let N=d.getTime()-s.getTime(),v=d.getTime();f(`[customScheduledTime] Scheduled for ${d.toISOString()} (in ${N}ms)`),this.scheduledTimeouts.customScheduledTime=window.setTimeout(async()=>{try{let y=Date.now(),A=Math.abs(y-v),F=5*60*1e3;if(A>F){f(`[customScheduledTime] Skipped - triggered ${Math.round(A/1e3/60)}min away from target (likely sleep recovery)`),this.scheduleCustomScheduledTime();return}await this.notes.checkAndCreateNotes(this.settings,{scheduleName:"customScheduledTime"})}catch(y){f(`Error in customScheduledTime: ${y.message}`),console.error("Auto Periodic Notes: Failed during custom scheduled check",y),new W.Notice("Auto Periodic Notes: Failed to create notes at scheduled time. Check console for details.")}finally{this.scheduleCustomScheduledTime()}},N)}scheduleAllDailyChecks(){this.scheduleMainDailyCheck(),this.scheduleCustomScheduledTime()}parseScheduledTime(n){let i=n.match(/^([01]\d|2[0-3]):([0-5]\d)$/);return i?[parseInt(i[1],10),parseInt(i[2],10)]:(f(`Invalid scheduled time: ${n}, using 00:02`),[0,2])}clearScheduledTimeout(n){this.scheduledTimeouts[n]!==null&&(window.clearTimeout(this.scheduledTimeouts[n]),this.scheduledTimeouts[n]=null,f(`Cleared timeout: ${n}`))}clearAllScheduledTimeouts(){Object.keys(this.scheduledTimeouts).forEach(n=>{this.clearScheduledTimeout(n)})}};
