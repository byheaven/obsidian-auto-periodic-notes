/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the GitHub repository of this plugin.
*/

var Xt=Object.create;var Te=Object.defineProperty;var Zt=Object.getOwnPropertyDescriptor;var ei=Object.getOwnPropertyNames;var ti=Object.getPrototypeOf,ii=Object.prototype.hasOwnProperty;var Ge=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ni=(t,e)=>{for(var i in e)Te(t,i,{get:e[i],enumerable:!0})},Je=(t,e,i,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of ei(e))!ii.call(t,a)&&a!==i&&Te(t,a,{get:()=>e[a],enumerable:!(n=Zt(e,a))||n.enumerable});return t};var Pe=(t,e,i)=>(i=t!=null?Xt(ti(t)):{},Je(e||!t||!t.__esModule?Te(i,"default",{value:t,enumerable:!0}):i,t)),ai=t=>Je(Te({},"__esModule",{value:!0}),t);var Ie=Ge((sn,ct)=>{var oi=Object.create,De=Object.defineProperty,ri=Object.getOwnPropertyDescriptor,si=Object.getOwnPropertyNames,li=Object.getPrototypeOf,ci=Object.prototype.hasOwnProperty,di=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ui=(t,e)=>{for(var i in e)De(t,i,{get:e[i],enumerable:!0})},it=(t,e,i,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of si(e))!ci.call(t,a)&&a!==i&&De(t,a,{get:()=>e[a],enumerable:!(n=ri(e,a))||n.enumerable});return t},le=(t,e,i)=>(i=t!=null?oi(li(t)):{},it(e||!t||!t.__esModule?De(i,"default",{value:t,enumerable:!0}):i,t)),pi=t=>it(De({},"__esModule",{value:!0}),t),ce=di(t=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e=require("obsidian"),i="YYYY-MM-DD",n="gggg-[W]ww",a="YYYY-MM",o="YYYY-[Q]Q",l="YYYY";function c(r){var s,d;let u=window.app.plugins.getPlugin("periodic-notes");return u&&((d=(s=u.settings)==null?void 0:s[r])==null?void 0:d.enabled)}function g(){var r,s,d,u;try{let{internalPlugins:h,plugins:m}=window.app;if(c("daily")){let{format:D,folder:_,template:M}=((s=(r=m.getPlugin("periodic-notes"))==null?void 0:r.settings)==null?void 0:s.daily)||{};return{format:D||i,folder:(_==null?void 0:_.trim())||"",template:(M==null?void 0:M.trim())||""}}let{folder:k,format:S,template:C}=((u=(d=h.getPluginById("daily-notes"))==null?void 0:d.instance)==null?void 0:u.options)||{};return{format:S||i,folder:(k==null?void 0:k.trim())||"",template:(C==null?void 0:C.trim())||""}}catch(h){console.info("No custom daily note settings found!",h)}}function y(){var r,s,d,u,h,m,k;try{let S=window.app.plugins,C=(r=S.getPlugin("calendar"))==null?void 0:r.options,D=(d=(s=S.getPlugin("periodic-notes"))==null?void 0:s.settings)==null?void 0:d.weekly;if(c("weekly"))return{format:D.format||n,folder:((u=D.folder)==null?void 0:u.trim())||"",template:((h=D.template)==null?void 0:h.trim())||""};let _=C||{};return{format:_.weeklyNoteFormat||n,folder:((m=_.weeklyNoteFolder)==null?void 0:m.trim())||"",template:((k=_.weeklyNoteTemplate)==null?void 0:k.trim())||""}}catch(S){console.info("No custom weekly note settings found!",S)}}function w(){var r,s,d,u;let h=window.app.plugins;try{let m=c("monthly")&&((s=(r=h.getPlugin("periodic-notes"))==null?void 0:r.settings)==null?void 0:s.monthly)||{};return{format:m.format||a,folder:((d=m.folder)==null?void 0:d.trim())||"",template:((u=m.template)==null?void 0:u.trim())||""}}catch(m){console.info("No custom monthly note settings found!",m)}}function N(){var r,s,d,u;let h=window.app.plugins;try{let m=c("quarterly")&&((s=(r=h.getPlugin("periodic-notes"))==null?void 0:r.settings)==null?void 0:s.quarterly)||{};return{format:m.format||o,folder:((d=m.folder)==null?void 0:d.trim())||"",template:((u=m.template)==null?void 0:u.trim())||""}}catch(m){console.info("No custom quarterly note settings found!",m)}}function P(){var r,s,d,u;let h=window.app.plugins;try{let m=c("yearly")&&((s=(r=h.getPlugin("periodic-notes"))==null?void 0:r.settings)==null?void 0:s.yearly)||{};return{format:m.format||l,folder:((d=m.folder)==null?void 0:d.trim())||"",template:((u=m.template)==null?void 0:u.trim())||""}}catch(m){console.info("No custom yearly note settings found!",m)}}function f(...r){let s=[];for(let u=0,h=r.length;u<h;u++)s=s.concat(r[u].split("/"));let d=[];for(let u=0,h=s.length;u<h;u++){let m=s[u];!m||m==="."||d.push(m)}return s[0]===""&&d.unshift(""),d.join("/")}function F(r){let s=r.substring(r.lastIndexOf("/")+1);return s.lastIndexOf(".")!=-1&&(s=s.substring(0,s.lastIndexOf("."))),s}async function E(r){let s=r.replace(/\\/g,"/").split("/");if(s.pop(),s.length){let d=f(...s);window.app.vault.getAbstractFileByPath(d)||await window.app.vault.createFolder(d)}}async function b(r,s){s.endsWith(".md")||(s+=".md");let d=e.normalizePath(f(r,s));return await E(d),d}async function T(r){let{metadataCache:s,vault:d}=window.app,u=e.normalizePath(r);if(u==="/")return Promise.resolve(["",null]);try{let h=s.getFirstLinkpathDest(u,""),m=await d.cachedRead(h),k=window.app.foldManager.load(h);return[m,k]}catch(h){return console.error(`Failed to read the daily note template '${u}'`,h),new e.Notice("Failed to read the daily note template"),["",null]}}function A(r,s="day"){let d=r.clone().startOf(s).format();return`${s}-${d}`}function U(r){return r.replace(/\[[^\]]*\]/g,"")}function be(r,s){if(s==="week"){let d=U(r);return/w{1,2}/i.test(d)&&(/M{1,4}/.test(d)||/D{1,4}/.test(d))}return!1}function W(r,s){return Ve(r.basename,s)}function Et(r,s){return Ve(F(r),s)}function Ve(r,s){let d={day:g,week:y,month:w,quarter:N,year:P}[s]().format.split("/").pop(),u=window.moment(r,d,!0);if(!u.isValid())return null;if(be(d,s)&&s==="week"){let h=U(d);if(/w{1,2}/i.test(h))return window.moment(r,d.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return u}var Ft=class extends Error{};async function Ue(r){let s=window.app,{vault:d}=s,u=window.moment,{template:h,format:m,folder:k}=g(),[S,C]=await T(h),D=r.format(m),_=await b(k,D);try{let M=await d.create(_,S.replace(/{{\s*date\s*}}/gi,D).replace(/{{\s*time\s*}}/gi,u().format("HH:mm")).replace(/{{\s*title\s*}}/gi,D).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(R,H,K,Y,$,I)=>{let Oe=u(),Ee=r.clone().set({hour:Oe.get("hour"),minute:Oe.get("minute"),second:Oe.get("second")});return K&&Ee.add(parseInt(Y,10),$),I?Ee.format(I.substring(1).trim()):Ee.format(m)}).replace(/{{\s*yesterday\s*}}/gi,r.clone().subtract(1,"day").format(m)).replace(/{{\s*tomorrow\s*}}/gi,r.clone().add(1,"d").format(m)));return s.foldManager.save(M,C),M}catch(M){console.error(`Failed to create file: '${_}'`,M),new e.Notice("Unable to create new file.")}}function Ct(r,s){var d;return(d=s[A(r,"day")])!=null?d:null}function It(){let{vault:r}=window.app,{folder:s}=g(),d=r.getAbstractFileByPath(e.normalizePath(s));if(!d)throw new Ft("Failed to find daily notes folder");let u={};return e.Vault.recurseChildren(d,h=>{if(h instanceof e.TFile){let m=W(h,"day");if(m){let k=A(m,"day");u[k]=h}}}),u}var Lt=class extends Error{};function $t(){let{moment:r}=window,s=r.localeData()._week.dow,d=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;s;)d.push(d.shift()),s--;return d}function xt(r){return $t().indexOf(r.toLowerCase())}async function Re(r){let{vault:s}=window.app,{template:d,format:u,folder:h}=y(),[m,k]=await T(d),S=r.format(u),C=await b(h,S);try{let D=await s.create(C,m.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(_,M,R,H,K,Y)=>{let $=window.moment(),I=r.clone().set({hour:$.get("hour"),minute:$.get("minute"),second:$.get("second")});return R&&I.add(parseInt(H,10),K),Y?I.format(Y.substring(1).trim()):I.format(u)}).replace(/{{\s*title\s*}}/gi,S).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(_,M,R)=>{let H=xt(M);return r.weekday(H).format(R.trim())}));return window.app.foldManager.save(D,k),D}catch(D){console.error(`Failed to create file: '${C}'`,D),new e.Notice("Unable to create new file.")}}function _t(r,s){var d;return(d=s[A(r,"week")])!=null?d:null}function Mt(){let r={};if(!Qe())return r;let{vault:s}=window.app,{folder:d}=y(),u=s.getAbstractFileByPath(e.normalizePath(d));if(!u)throw new Lt("Failed to find weekly notes folder");return e.Vault.recurseChildren(u,h=>{if(h instanceof e.TFile){let m=W(h,"week");if(m){let k=A(m,"week");r[k]=h}}}),r}var Yt=class extends Error{};async function He(r){let{vault:s}=window.app,{template:d,format:u,folder:h}=w(),[m,k]=await T(d),S=r.format(u),C=await b(h,S);try{let D=await s.create(C,m.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(_,M,R,H,K,Y)=>{let $=window.moment(),I=r.clone().set({hour:$.get("hour"),minute:$.get("minute"),second:$.get("second")});return R&&I.add(parseInt(H,10),K),Y?I.format(Y.substring(1).trim()):I.format(u)}).replace(/{{\s*date\s*}}/gi,S).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,S));return window.app.foldManager.save(D,k),D}catch(D){console.error(`Failed to create file: '${C}'`,D),new e.Notice("Unable to create new file.")}}function Wt(r,s){var d;return(d=s[A(r,"month")])!=null?d:null}function qt(){let r={};if(!je())return r;let{vault:s}=window.app,{folder:d}=w(),u=s.getAbstractFileByPath(e.normalizePath(d));if(!u)throw new Yt("Failed to find monthly notes folder");return e.Vault.recurseChildren(u,h=>{if(h instanceof e.TFile){let m=W(h,"month");if(m){let k=A(m,"month");r[k]=h}}}),r}var Vt=class extends Error{};async function Ut(r){let{vault:s}=window.app,{template:d,format:u,folder:h}=N(),[m,k]=await T(d),S=r.format(u),C=await b(h,S);try{let D=await s.create(C,m.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(_,M,R,H,K,Y)=>{let $=window.moment(),I=r.clone().set({hour:$.get("hour"),minute:$.get("minute"),second:$.get("second")});return R&&I.add(parseInt(H,10),K),Y?I.format(Y.substring(1).trim()):I.format(u)}).replace(/{{\s*date\s*}}/gi,S).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,S));return window.app.foldManager.save(D,k),D}catch(D){console.error(`Failed to create file: '${C}'`,D),new e.Notice("Unable to create new file.")}}function Rt(r,s){var d;return(d=s[A(r,"quarter")])!=null?d:null}function Ht(){let r={};if(!ze())return r;let{vault:s}=window.app,{folder:d}=N(),u=s.getAbstractFileByPath(e.normalizePath(d));if(!u)throw new Vt("Failed to find quarterly notes folder");return e.Vault.recurseChildren(u,h=>{if(h instanceof e.TFile){let m=W(h,"quarter");if(m){let k=A(m,"quarter");r[k]=h}}}),r}var Qt=class extends Error{};async function jt(r){let{vault:s}=window.app,{template:d,format:u,folder:h}=P(),[m,k]=await T(d),S=r.format(u),C=await b(h,S);try{let D=await s.create(C,m.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(_,M,R,H,K,Y)=>{let $=window.moment(),I=r.clone().set({hour:$.get("hour"),minute:$.get("minute"),second:$.get("second")});return R&&I.add(parseInt(H,10),K),Y?I.format(Y.substring(1).trim()):I.format(u)}).replace(/{{\s*date\s*}}/gi,S).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,S));return window.app.foldManager.save(D,k),D}catch(D){console.error(`Failed to create file: '${C}'`,D),new e.Notice("Unable to create new file.")}}function zt(r,s){var d;return(d=s[A(r,"year")])!=null?d:null}function Bt(){let r={};if(!Be())return r;let{vault:s}=window.app,{folder:d}=P(),u=s.getAbstractFileByPath(e.normalizePath(d));if(!u)throw new Qt("Failed to find yearly notes folder");return e.Vault.recurseChildren(u,h=>{if(h instanceof e.TFile){let m=W(h,"year");if(m){let k=A(m,"year");r[k]=h}}}),r}function Gt(){var r,s;let{app:d}=window,u=d.internalPlugins.plugins["daily-notes"];if(u&&u.enabled)return!0;let h=d.plugins.getPlugin("periodic-notes");return h&&((s=(r=h.settings)==null?void 0:r.daily)==null?void 0:s.enabled)}function Qe(){var r,s;let{app:d}=window;if(d.plugins.getPlugin("calendar"))return!0;let u=d.plugins.getPlugin("periodic-notes");return u&&((s=(r=u.settings)==null?void 0:r.weekly)==null?void 0:s.enabled)}function je(){var r,s;let{app:d}=window,u=d.plugins.getPlugin("periodic-notes");return u&&((s=(r=u.settings)==null?void 0:r.monthly)==null?void 0:s.enabled)}function ze(){var r,s;let{app:d}=window,u=d.plugins.getPlugin("periodic-notes");return u&&((s=(r=u.settings)==null?void 0:r.quarterly)==null?void 0:s.enabled)}function Be(){var r,s;let{app:d}=window,u=d.plugins.getPlugin("periodic-notes");return u&&((s=(r=u.settings)==null?void 0:r.yearly)==null?void 0:s.enabled)}function Jt(r){let s={day:g,week:y,month:w,quarter:N,year:P}[r];return s()}function Kt(r,s){return{day:Ue,month:He,week:Re}[r](s)}t.DEFAULT_DAILY_NOTE_FORMAT=i,t.DEFAULT_MONTHLY_NOTE_FORMAT=a,t.DEFAULT_QUARTERLY_NOTE_FORMAT=o,t.DEFAULT_WEEKLY_NOTE_FORMAT=n,t.DEFAULT_YEARLY_NOTE_FORMAT=l,t.appHasDailyNotesPluginLoaded=Gt,t.appHasMonthlyNotesPluginLoaded=je,t.appHasQuarterlyNotesPluginLoaded=ze,t.appHasWeeklyNotesPluginLoaded=Qe,t.appHasYearlyNotesPluginLoaded=Be,t.createDailyNote=Ue,t.createMonthlyNote=He,t.createPeriodicNote=Kt,t.createQuarterlyNote=Ut,t.createWeeklyNote=Re,t.createYearlyNote=jt,t.getAllDailyNotes=It,t.getAllMonthlyNotes=qt,t.getAllQuarterlyNotes=Ht,t.getAllWeeklyNotes=Mt,t.getAllYearlyNotes=Bt,t.getDailyNote=Ct,t.getDailyNoteSettings=g,t.getDateFromFile=W,t.getDateFromPath=Et,t.getDateUID=A,t.getMonthlyNote=Wt,t.getMonthlyNoteSettings=w,t.getPeriodicNoteSettings=Jt,t.getQuarterlyNote=Rt,t.getQuarterlyNoteSettings=N,t.getTemplateInfo=T,t.getWeeklyNote=_t,t.getWeeklyNoteSettings=y,t.getYearlyNote=zt,t.getYearlyNoteSettings=P}),nt={};ui(nt,{DEFAULT_SETTINGS:()=>Ce,DailyNote:()=>mi,MonthlyNote:()=>fi,PERIODIC_NOTES_EVENT_SETTING_UPDATED:()=>Ci,PLUGIN_NAME:()=>Fe,PeriodicNotesPluginAdapter:()=>Fi,QuarterlyNote:()=>Ni,V0Provider:()=>at,V1Provider:()=>lt,WeeklyNote:()=>bi,YearlyNote:()=>Pi,checkCreateTime:()=>oe});ct.exports=pi(nt);var Ke=require("obsidian"),Q=le(ce()),gi=1e3,de=class{};function oe(t){return t.stat.ctime>new Date().getTime()-gi}var hi=30,ee="day",mi=class extends de{constructor(){super(...arguments),this.date=(0,Ke.moment)()}getDate(){return(0,Ke.moment)().startOf(ee)}async create(){let t=this.date.clone().startOf(ee);return(0,Q.createDailyNote)(t)}getAllPaths(){let t=(0,Q.getAllDailyNotes)();return Object.entries(t).map(([e,i])=>i.path)}getCurrent(){return(0,Q.getDailyNote)(this.date,(0,Q.getAllDailyNotes)())}getNextDate(){return this.getDate().clone().add(1,ee)}getPrevious(){let t=this.getDate().clone().subtract(1,ee),e=t.clone().subtract(hi,ee),i=(0,Q.getAllDailyNotes)(),n;do n=(0,Q.getDailyNote)(t,i),t.subtract(1,ee);while(!n&&t.isAfter(e));return n}isPresent(){let t=this.date.clone().startOf(ee),e=(0,Q.getAllDailyNotes)();return!!(0,Q.getDailyNote)(t,e)}isValid(t){let e=(0,Q.getDailyNote)(this.getDate(),(0,Q.getAllDailyNotes)());return e?e.name===t.name&&oe(e):!1}},Xe=require("obsidian"),j=le(ce()),yi=12,te="month",fi=class extends de{constructor(){super(...arguments),this.date=(0,Xe.moment)()}getDate(){return(0,Xe.moment)().startOf(te)}async create(){let t=this.date.clone().startOf(te);return(0,j.createMonthlyNote)(t)}getAllPaths(){let t=(0,j.getAllMonthlyNotes)();return Object.entries(t).map(([e,i])=>i.path)}getCurrent(){return(0,j.getMonthlyNote)(this.date,(0,j.getAllMonthlyNotes)())}getNextDate(){return this.getDate().clone().add(1,te)}getPrevious(){let t=this.getDate().clone().subtract(1,te),e=t.clone().subtract(yi,te),i=(0,j.getAllMonthlyNotes)(),n;do n=(0,j.getMonthlyNote)(t,i),t.subtract(1,te);while(!n&&t.isAfter(e));return n}isPresent(){let t=this.date.clone().startOf(te),e=(0,j.getAllMonthlyNotes)();return!!(0,j.getMonthlyNote)(t,e)}isValid(t){let e=(0,j.getMonthlyNote)(this.getDate(),(0,j.getAllMonthlyNotes)());return e?e.name===t.name&&oe(e):!1}},Ze=require("obsidian"),z=le(ce()),wi=4,ie="quarter",Ni=class extends de{constructor(){super(...arguments),this.date=(0,Ze.moment)()}getDate(){return(0,Ze.moment)().startOf(ie)}async create(){let t=this.date.clone().startOf(ie);return(0,z.createQuarterlyNote)(t)}getAllPaths(){let t=(0,z.getAllQuarterlyNotes)();return Object.entries(t).map(([e,i])=>i.path)}getCurrent(){return(0,z.getQuarterlyNote)(this.date,(0,z.getAllQuarterlyNotes)())}getNextDate(){return this.getDate().clone().add(1,ie)}getPrevious(){let t=this.getDate().clone().subtract(1,ie),e=t.clone().subtract(wi,ie),i=(0,z.getAllQuarterlyNotes)(),n;do n=(0,z.getQuarterlyNote)(t,i),t.subtract(1,ie);while(!n&&t.isAfter(e));return n}isPresent(){let t=this.date.clone().startOf(ie),e=(0,z.getAllQuarterlyNotes)();return!!(0,z.getQuarterlyNote)(t,e)}isValid(t){let e=(0,z.getQuarterlyNote)(this.getDate(),(0,z.getAllQuarterlyNotes)());return e?e.name===t.name&&oe(e):!1}},et=require("obsidian"),B=le(ce()),vi=8,ne="week",bi=class extends de{constructor(){super(...arguments),this.date=(0,et.moment)()}getDate(){return(0,et.moment)().startOf(ne)}async create(){let t=this.date.clone().startOf(ne);return(0,B.createWeeklyNote)(t)}getAllPaths(){let t=(0,B.getAllWeeklyNotes)();return Object.entries(t).map(([e,i])=>i.path)}getCurrent(){return(0,B.getWeeklyNote)(this.date,(0,B.getAllWeeklyNotes)())}getNextDate(){return this.getDate().clone().add(1,ne)}getPrevious(){let t=this.getDate().clone().subtract(1,ne),e=t.clone().subtract(vi,ne),i=(0,B.getAllWeeklyNotes)(),n;do n=(0,B.getWeeklyNote)(t,i),t.subtract(1,ne);while(!n&&t.isAfter(e));return n}isPresent(){let t=this.date.clone().startOf(ne),e=(0,B.getAllWeeklyNotes)();return!!(0,B.getWeeklyNote)(t,e)}isValid(t){let e=(0,B.getWeeklyNote)(this.getDate(),(0,B.getAllWeeklyNotes)());return e?e.name===t.name&&oe(e):!1}},tt=require("obsidian"),G=le(ce()),Ti=5,ae="year",Pi=class extends de{constructor(){super(...arguments),this.date=(0,tt.moment)()}getDate(){return(0,tt.moment)().startOf(ae)}async create(){let t=this.date.clone().startOf(ae);return(0,G.createYearlyNote)(t)}getAllPaths(){let t=(0,G.getAllYearlyNotes)();return Object.entries(t).map(([e,i])=>i.path)}getCurrent(){return(0,G.getYearlyNote)(this.date,(0,G.getAllYearlyNotes)())}getNextDate(){return this.getDate().clone().add(1,ae)}getPrevious(){let t=this.getDate().clone().subtract(1,ae),e=t.clone().subtract(Ti,ae),i=(0,G.getAllYearlyNotes)(),n;do n=(0,G.getYearlyNote)(t,i),t.subtract(1,ae);while(!n&&t.isAfter(e));return n}isPresent(){let t=this.date.clone().startOf(ae),e=(0,G.getAllYearlyNotes)();return!!(0,G.getYearlyNote)(t,e)}isValid(t){let e=(0,G.getYearlyNote)(this.getDate(),(0,G.getAllYearlyNotes)());return e?e.name===t.name&&oe(e):!1}},at=class{convertSettings(t){let e=t,i=Object.assign({},Ce);return i.daily.available=e.daily.enabled,i.weekly.available=e.weekly.enabled,i.monthly.available=e.monthly.enabled,i.quarterly.available=e.quarterly.enabled,i.yearly.available=e.yearly.enabled,i}};function ot(){}function rt(t){return t()}function st(t){t.forEach(rt)}function Di(t){return typeof t=="function"}function ki(t){return Object.keys(t).length===0}function Ai(t,...e){if(t==null)return ot;let i=t.subscribe(...e);return i.unsubscribe?()=>i.unsubscribe():i}function Si(t){let e;return Ai(t,i=>e=i)(),e}var on=Promise.resolve(),rn=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function Oi(t,e){let i=t.$$;i.fragment!==null&&(st(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}var Ei;typeof HTMLElement=="function"&&(Ei=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){let{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(rt).filter(Di);for(let e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(t,e,i){this[t]=i}disconnectedCallback(){st(this.$$.on_disconnect)}$destroy(){Oi(this,1),this.$destroy=ot}$on(t,e){let i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(e),()=>{let n=i.indexOf(e);n!==-1&&i.splice(n,1)}}$set(t){this.$$set&&!ki(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});var lt=class{convertSettings(t){var e,i,n,a,o;let l=Si(t),c=l.calendarSets.filter(y=>y.id===l.activeCalendarSet),g=Object.assign({},Ce);return g.daily.available=!1,g.weekly.available=!1,g.monthly.available=!1,g.quarterly.available=!1,g.yearly.available=!1,c.length&&(g.daily.available=((e=c[0].day)==null?void 0:e.enabled)||!1,g.weekly.available=((i=c[0].week)==null?void 0:i.enabled)||!1,g.monthly.available=((n=c[0].month)==null?void 0:n.enabled)||!1,g.quarterly.available=((a=c[0].quarter)==null?void 0:a.enabled)||!1,g.yearly.available=((o=c[0].year)==null?void 0:o.enabled)||!1),g}},Fi=class{constructor(t){this.app=t}getProvider(){return this.getPlugin().settings.daily!==void 0?new at:new lt}getPlugin(){return this.app.plugins.getPlugin(Fe)}isEnabled(){return this.app.plugins.enabledPlugins.has(Fe)}convertSettings(){return this.getProvider().convertSettings(this.getPlugin().settings)}},Ci="periodic-notes:settings-updated",Fe="periodic-notes",Ce={daily:{available:!1},weekly:{available:!1},monthly:{available:!1},quarterly:{available:!1},yearly:{available:!1}}});var At=Ge(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});var O=require("obsidian"),$e="YYYY-MM-DD",xe="gggg-[W]ww",gt="YYYY-MM",ht="YYYY-[Q]Q",mt="YYYY";function ue(t){var i,n;let e=window.app.plugins.getPlugin("periodic-notes");return e&&((n=(i=e.settings)==null?void 0:i[t])==null?void 0:n.enabled)}function pe(){var t,e,i,n;try{let{internalPlugins:a,plugins:o}=window.app;if(ue("daily")){let{format:y,folder:w,template:N}=((e=(t=o.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.daily)||{};return{format:y||$e,folder:(w==null?void 0:w.trim())||"",template:(N==null?void 0:N.trim())||""}}let{folder:l,format:c,template:g}=((n=(i=a.getPluginById("daily-notes"))==null?void 0:i.instance)==null?void 0:n.options)||{};return{format:c||$e,folder:(l==null?void 0:l.trim())||"",template:(g==null?void 0:g.trim())||""}}catch(a){console.info("No custom daily note settings found!",a)}}function ge(){var t,e,i,n,a,o,l;try{let c=window.app.plugins,g=(t=c.getPlugin("calendar"))==null?void 0:t.options,y=(i=(e=c.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:i.weekly;if(ue("weekly"))return{format:y.format||xe,folder:((n=y.folder)==null?void 0:n.trim())||"",template:((a=y.template)==null?void 0:a.trim())||""};let w=g||{};return{format:w.weeklyNoteFormat||xe,folder:((o=w.weeklyNoteFolder)==null?void 0:o.trim())||"",template:((l=w.weeklyNoteTemplate)==null?void 0:l.trim())||""}}catch(c){console.info("No custom weekly note settings found!",c)}}function he(){var e,i,n,a;let t=window.app.plugins;try{let o=ue("monthly")&&((i=(e=t.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:i.monthly)||{};return{format:o.format||gt,folder:((n=o.folder)==null?void 0:n.trim())||"",template:((a=o.template)==null?void 0:a.trim())||""}}catch(o){console.info("No custom monthly note settings found!",o)}}function me(){var e,i,n,a;let t=window.app.plugins;try{let o=ue("quarterly")&&((i=(e=t.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:i.quarterly)||{};return{format:o.format||ht,folder:((n=o.folder)==null?void 0:n.trim())||"",template:((a=o.template)==null?void 0:a.trim())||""}}catch(o){console.info("No custom quarterly note settings found!",o)}}function ye(){var e,i,n,a;let t=window.app.plugins;try{let o=ue("yearly")&&((i=(e=t.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:i.yearly)||{};return{format:o.format||mt,folder:((n=o.folder)==null?void 0:n.trim())||"",template:((a=o.template)==null?void 0:a.trim())||""}}catch(o){console.info("No custom yearly note settings found!",o)}}function yt(...t){let e=[];for(let n=0,a=t.length;n<a;n++)e=e.concat(t[n].split("/"));let i=[];for(let n=0,a=e.length;n<a;n++){let o=e[n];!o||o==="."||i.push(o)}return e[0]===""&&i.unshift(""),i.join("/")}function Li(t){let e=t.substring(t.lastIndexOf("/")+1);return e.lastIndexOf(".")!=-1&&(e=e.substring(0,e.lastIndexOf("."))),e}async function $i(t){let e=t.replace(/\\/g,"/").split("/");if(e.pop(),e.length){let i=yt(...e);window.app.vault.getAbstractFileByPath(i)||await window.app.vault.createFolder(i)}}async function fe(t,e){e.endsWith(".md")||(e+=".md");let i=O.normalizePath(yt(t,e));return await $i(i),i}async function re(t){let{metadataCache:e,vault:i}=window.app,n=O.normalizePath(t);if(n==="/")return Promise.resolve(["",null]);try{let a=e.getFirstLinkpathDest(n,""),o=await i.cachedRead(a),l=window.app.foldManager.load(a);return[o,l]}catch(a){return console.error(`Failed to read the daily note template '${n}'`,a),new O.Notice("Failed to read the daily note template"),["",null]}}function q(t,e="day"){let i=t.clone().startOf(e).format();return`${e}-${i}`}function ft(t){return t.replace(/\[[^\]]*\]/g,"")}function xi(t,e){if(e==="week"){let i=ft(t);return/w{1,2}/i.test(i)&&(/M{1,4}/.test(i)||/D{1,4}/.test(i))}return!1}function se(t,e){return wt(t.basename,e)}function _i(t,e){return wt(Li(t),e)}function wt(t,e){let n={day:pe,week:ge,month:he,quarter:me,year:ye}[e]().format.split("/").pop(),a=window.moment(t,n,!0);if(!a.isValid())return null;if(xi(n,e)&&e==="week"){let o=ft(n);if(/w{1,2}/i.test(o))return window.moment(t,n.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return a}var _e=class extends Error{};async function Nt(t){let e=window.app,{vault:i}=e,n=window.moment,{template:a,format:o,folder:l}=pe(),[c,g]=await re(a),y=t.format(o),w=await fe(l,y);try{let N=await i.create(w,c.replace(/{{\s*date\s*}}/gi,y).replace(/{{\s*time\s*}}/gi,n().format("HH:mm")).replace(/{{\s*title\s*}}/gi,y).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(P,f,F,E,b,T)=>{let A=n(),U=t.clone().set({hour:A.get("hour"),minute:A.get("minute"),second:A.get("second")});return F&&U.add(parseInt(E,10),b),T?U.format(T.substring(1).trim()):U.format(o)}).replace(/{{\s*yesterday\s*}}/gi,t.clone().subtract(1,"day").format(o)).replace(/{{\s*tomorrow\s*}}/gi,t.clone().add(1,"d").format(o)));return e.foldManager.save(N,g),N}catch(N){console.error(`Failed to create file: '${w}'`,N),new O.Notice("Unable to create new file.")}}function Mi(t,e){var i;return(i=e[q(t,"day")])!=null?i:null}function Yi(){let{vault:t}=window.app,{folder:e}=pe(),i=t.getAbstractFileByPath(O.normalizePath(e));if(!i)throw new _e("Failed to find daily notes folder");let n={};return O.Vault.recurseChildren(i,a=>{if(a instanceof O.TFile){let o=se(a,"day");if(o){let l=q(o,"day");n[l]=a}}}),n}var Me=class extends Error{};function Wi(){let{moment:t}=window,e=t.localeData()._week.dow,i=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;e;)i.push(i.shift()),e--;return i}function qi(t){return Wi().indexOf(t.toLowerCase())}async function vt(t){let{vault:e}=window.app,{template:i,format:n,folder:a}=ge(),[o,l]=await re(i),c=t.format(n),g=await fe(a,c);try{let y=await e.create(g,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(w,N,P,f,F,E)=>{let b=window.moment(),T=t.clone().set({hour:b.get("hour"),minute:b.get("minute"),second:b.get("second")});return P&&T.add(parseInt(f,10),F),E?T.format(E.substring(1).trim()):T.format(n)}).replace(/{{\s*title\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(w,N,P)=>{let f=qi(N);return t.weekday(f).format(P.trim())}));return window.app.foldManager.save(y,l),y}catch(y){console.error(`Failed to create file: '${g}'`,y),new O.Notice("Unable to create new file.")}}function Vi(t,e){var i;return(i=e[q(t,"week")])!=null?i:null}function Ui(){let t={};if(!Tt())return t;let{vault:e}=window.app,{folder:i}=ge(),n=e.getAbstractFileByPath(O.normalizePath(i));if(!n)throw new Me("Failed to find weekly notes folder");return O.Vault.recurseChildren(n,a=>{if(a instanceof O.TFile){let o=se(a,"week");if(o){let l=q(o,"week");t[l]=a}}}),t}var Ye=class extends Error{};async function bt(t){let{vault:e}=window.app,{template:i,format:n,folder:a}=he(),[o,l]=await re(i),c=t.format(n),g=await fe(a,c);try{let y=await e.create(g,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(w,N,P,f,F,E)=>{let b=window.moment(),T=t.clone().set({hour:b.get("hour"),minute:b.get("minute"),second:b.get("second")});return P&&T.add(parseInt(f,10),F),E?T.format(E.substring(1).trim()):T.format(n)}).replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c));return window.app.foldManager.save(y,l),y}catch(y){console.error(`Failed to create file: '${g}'`,y),new O.Notice("Unable to create new file.")}}function Ri(t,e){var i;return(i=e[q(t,"month")])!=null?i:null}function Hi(){let t={};if(!Pt())return t;let{vault:e}=window.app,{folder:i}=he(),n=e.getAbstractFileByPath(O.normalizePath(i));if(!n)throw new Ye("Failed to find monthly notes folder");return O.Vault.recurseChildren(n,a=>{if(a instanceof O.TFile){let o=se(a,"month");if(o){let l=q(o,"month");t[l]=a}}}),t}var We=class extends Error{};async function Qi(t){let{vault:e}=window.app,{template:i,format:n,folder:a}=me(),[o,l]=await re(i),c=t.format(n),g=await fe(a,c);try{let y=await e.create(g,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(w,N,P,f,F,E)=>{let b=window.moment(),T=t.clone().set({hour:b.get("hour"),minute:b.get("minute"),second:b.get("second")});return P&&T.add(parseInt(f,10),F),E?T.format(E.substring(1).trim()):T.format(n)}).replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c));return window.app.foldManager.save(y,l),y}catch(y){console.error(`Failed to create file: '${g}'`,y),new O.Notice("Unable to create new file.")}}function ji(t,e){var i;return(i=e[q(t,"quarter")])!=null?i:null}function zi(){let t={};if(!Dt())return t;let{vault:e}=window.app,{folder:i}=me(),n=e.getAbstractFileByPath(O.normalizePath(i));if(!n)throw new We("Failed to find quarterly notes folder");return O.Vault.recurseChildren(n,a=>{if(a instanceof O.TFile){let o=se(a,"quarter");if(o){let l=q(o,"quarter");t[l]=a}}}),t}var qe=class extends Error{};async function Bi(t){let{vault:e}=window.app,{template:i,format:n,folder:a}=ye(),[o,l]=await re(i),c=t.format(n),g=await fe(a,c);try{let y=await e.create(g,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(w,N,P,f,F,E)=>{let b=window.moment(),T=t.clone().set({hour:b.get("hour"),minute:b.get("minute"),second:b.get("second")});return P&&T.add(parseInt(f,10),F),E?T.format(E.substring(1).trim()):T.format(n)}).replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c));return window.app.foldManager.save(y,l),y}catch(y){console.error(`Failed to create file: '${g}'`,y),new O.Notice("Unable to create new file.")}}function Gi(t,e){var i;return(i=e[q(t,"year")])!=null?i:null}function Ji(){let t={};if(!kt())return t;let{vault:e}=window.app,{folder:i}=ye(),n=e.getAbstractFileByPath(O.normalizePath(i));if(!n)throw new qe("Failed to find yearly notes folder");return O.Vault.recurseChildren(n,a=>{if(a instanceof O.TFile){let o=se(a,"year");if(o){let l=q(o,"year");t[l]=a}}}),t}function Ki(){var n,a;let{app:t}=window,e=t.internalPlugins.plugins["daily-notes"];if(e&&e.enabled)return!0;let i=t.plugins.getPlugin("periodic-notes");return i&&((a=(n=i.settings)==null?void 0:n.daily)==null?void 0:a.enabled)}function Tt(){var i,n;let{app:t}=window;if(t.plugins.getPlugin("calendar"))return!0;let e=t.plugins.getPlugin("periodic-notes");return e&&((n=(i=e.settings)==null?void 0:i.weekly)==null?void 0:n.enabled)}function Pt(){var i,n;let{app:t}=window,e=t.plugins.getPlugin("periodic-notes");return e&&((n=(i=e.settings)==null?void 0:i.monthly)==null?void 0:n.enabled)}function Dt(){var i,n;let{app:t}=window,e=t.plugins.getPlugin("periodic-notes");return e&&((n=(i=e.settings)==null?void 0:i.quarterly)==null?void 0:n.enabled)}function kt(){var i,n;let{app:t}=window,e=t.plugins.getPlugin("periodic-notes");return e&&((n=(i=e.settings)==null?void 0:i.yearly)==null?void 0:n.enabled)}function Xi(t){let e={day:pe,week:ge,month:he,quarter:me,year:ye}[t];return e()}function Zi(t,e){return{day:Nt,month:bt,week:vt}[t](e)}v.DEFAULT_DAILY_NOTE_FORMAT=$e;v.DEFAULT_MONTHLY_NOTE_FORMAT=gt;v.DEFAULT_QUARTERLY_NOTE_FORMAT=ht;v.DEFAULT_WEEKLY_NOTE_FORMAT=xe;v.DEFAULT_YEARLY_NOTE_FORMAT=mt;v.appHasDailyNotesPluginLoaded=Ki;v.appHasMonthlyNotesPluginLoaded=Pt;v.appHasQuarterlyNotesPluginLoaded=Dt;v.appHasWeeklyNotesPluginLoaded=Tt;v.appHasYearlyNotesPluginLoaded=kt;v.createDailyNote=Nt;v.createMonthlyNote=bt;v.createPeriodicNote=Zi;v.createQuarterlyNote=Qi;v.createWeeklyNote=vt;v.createYearlyNote=Bi;v.getAllDailyNotes=Yi;v.getAllMonthlyNotes=Hi;v.getAllQuarterlyNotes=zi;v.getAllWeeklyNotes=Ui;v.getAllYearlyNotes=Ji;v.getDailyNote=Mi;v.getDailyNoteSettings=pe;v.getDateFromFile=se;v.getDateFromPath=_i;v.getDateUID=q;v.getMonthlyNote=Ri;v.getMonthlyNoteSettings=he;v.getPeriodicNoteSettings=Xi;v.getQuarterlyNote=ji;v.getQuarterlyNoteSettings=me;v.getTemplateInfo=re;v.getWeeklyNote=Vi;v.getWeeklyNoteSettings=ge;v.getYearlyNote=Gi;v.getYearlyNoteSettings=ye});var nn={};ni(nn,{default:()=>Ae});module.exports=ai(nn);var V=require("obsidian"),Se=Pe(Ie());function dt(t,e){let i=Object.keys(e).map(n=>Ii(t,n,e[n]));return i.length===1?i[0]:function(){i.forEach(n=>n())}}function Ii(t,e,i){let n=t[e],a=t.hasOwnProperty(e),o=a?n:function(){return Object.getPrototypeOf(t)[e].apply(this,arguments)},l=i(o);return n&&Object.setPrototypeOf(l,n),Object.setPrototypeOf(c,l),t[e]=c,g;function c(...y){return l===o&&t[e]===c&&g(),l.apply(this,y)}function g(){t[e]===c&&(a?t[e]=o:delete t[e]),l!==o&&(l=o,Object.setPrototypeOf(c,n||Function))}}var Ot=Pe(require("os"));var ut="auto-periodic-notes:settings-updated";var pt=!1;function Le(t){pt=t}function p(t){pt&&console.log(`[Auto Periodic Notes] ${t}`)}var X=require("obsidian");var x=Pe(Ie()),J=Pe(At());function en(t){var i;let e=t.plugins;return((i=e==null?void 0:e.plugins)==null?void 0:i["templater-obsidian"])||null}async function ke(t,e,i=!1){var a;let n=en(t);if(!n){p("Templater plugin not found or not enabled");return}if(i||!((a=n==null?void 0:n.settings)!=null&&a.trigger_on_file_creation)){p(`Processing Templater commands in file: ${e.path}`);try{await new Promise(g=>setTimeout(g,500));let o=t.workspace.getActiveFile(),l=(o==null?void 0:o.path)===e.path,c=null;l||(c=t.workspace.getLeaf("tab"),await c.openFile(e),await new Promise(g=>setTimeout(g,200))),await n.templater.overwrite_active_file_commands(),await new Promise(g=>setTimeout(g,300)),c&&!l&&c.detach(),p("Templater processing completed successfully")}catch(o){p(`Error processing Templater commands: ${o}`)}}else p("Skipping Templater processing - trigger_on_file_creation is enabled")}var tn=1e3,we=class{constructor(e,i,n,a){this.workspace=e,this.app=i,this.plugin=n,this.waitTimeout=a||tn,this.workspaceLeaves={}}async checkAndCreateNotes(e,i){p(`Checking if any new notes need to be created (context: ${(i==null?void 0:i.scheduleName)||"manual"})`),await this.checkAndCreateSingleNote(e.yearly,new x.YearlyNote,"yearly",e.alwaysOpen,e.processTemplater,i),await this.checkAndCreateSingleNote(e.quarterly,new x.QuarterlyNote,"quarterly",e.alwaysOpen,e.processTemplater,i),await this.checkAndCreateSingleNote(e.monthly,new x.MonthlyNote,"monthly",e.alwaysOpen,e.processTemplater,i),await this.checkAndCreateSingleNote(e.weekly,new x.WeeklyNote,"weekly",e.alwaysOpen,e.processTemplater,i),await this.checkAndCreateSingleNote(e.daily,new x.DailyNote,"daily",e.alwaysOpen,e.processTemplater,i)}async checkAndCreateNextPeriodNotes(e,i){p(`Creating next period notes (context: ${(i==null?void 0:i.scheduleName)||"manual"})`),await this.checkAndCreateSingleNote(e.yearly,new x.YearlyNote,"yearly",e.alwaysOpen,e.processTemplater,i,!0),await this.checkAndCreateSingleNote(e.quarterly,new x.QuarterlyNote,"quarterly",e.alwaysOpen,e.processTemplater,i,!0),await this.checkAndCreateSingleNote(e.monthly,new x.MonthlyNote,"monthly",e.alwaysOpen,e.processTemplater,i,!0),await this.checkAndCreateSingleNote(e.weekly,new x.WeeklyNote,"weekly",e.alwaysOpen,e.processTemplater,i,!0),await this.checkAndCreateSingleNote(e.daily,new x.DailyNote,"daily",e.alwaysOpen,e.processTemplater,i,!0)}async checkAndCreateSingleNote(e,i,n,a,o,l,c=!1){var g,y;if(e.available&&e.enabled)if(this.workspaceLeaves={},p(`Checking if ${n} note needs to be created`),n==="daily"){let w=e,N=(l==null?void 0:l.scheduleName)==="scheduledTime";if(N||c||w.createTomorrowsNote||w.unpinOldDailyNotes){let f=(0,X.moment)();if(c){if(f=f.add(1,"day"),w.excludeWeekends)for(;f.format("dd")==="Sa"||f.format("dd")==="Su";)f=f.add(1,"day");p(`Target date for next period: ${f.format("YYYY-MM-DD")}`)}else if(N&&w.createTomorrowsNote){if(f=f.add(1,"day"),w.excludeWeekends)for(;f.format("dd")==="Sa"||f.format("dd")==="Su";)f=f.add(1,"day");p(`Target date for custom scheduled time: ${f.format("YYYY-MM-DD")}`)}else if(w.excludeWeekends){let b=f.format("dd");if(b==="Sa"||b==="Su"){p("Not creating new note as it is a weekend");return}}let F=(0,J.getAllDailyNotes)(),E=(0,J.getDailyNote)(f,F);if(!E){let b=(0,J.getDailyNoteSettings)(),T=b.format||J.DEFAULT_DAILY_NOTE_FORMAT,A=((g=b.folder)==null?void 0:g.trim())||"",U=f.format(T),be=A?`${A}/${U}.md`:`${U}.md`,W=this.app.vault.getAbstractFileByPath(be);W&&"path"in W&&((y=W.path)!=null&&y.endsWith(".md"))&&(p(`Note not in cache but exists in filesystem: ${be}`),E=W)}if(E){let T=(l==null?void 0:l.scheduleName)==="startup"&&e.closeExisting,A=N&&w.unpinOldDailyNotes;(a||T||A||N)&&(p(`Daily note exists for ${f.format("YYYY-MM-DD")}, handling existing tabs`),A?await this.handleUnpin(e,i,E):T&&await this.handleClose(e,i,E),await this.handleOpen(e,E,n))}else{p(`Creating daily note for ${f.format("YYYY-MM-DD")}`);let b=await(0,J.createDailyNote)(f),T=(0,X.moment)(),A=f.isAfter(T,"day");new X.Notice(A?"Tomorrow's daily note has been created.":"Today's daily note has been created.",5e3),N&&w.unpinOldDailyNotes?await this.handleUnpin(e,i,b):await this.handleClose(e,i,b),await this.handleOpen(e,b,n),o&&await ke(this.app,b,!0)}}else if(i.isPresent()){if(a){p(`Set to always open notes, getting current ${n} note`);let f=i.getCurrent();await this.handleClose(e,i,f),await this.handleOpen(e,f,n)}}else{if(w.excludeWeekends){let F=(0,X.moment)();if(F.format("dd")==="Sa"||F.format("dd")==="Su"){p("Not creating new note as it is a weekend");return}}p(`Creating new ${n} note`);let f=await i.create();new X.Notice(`Today's ${n} note has been created.`,5e3),await this.handleClose(e,i,f),await this.handleOpen(e,f,n),o&&await ke(this.app,f,!0)}}else if(i.isPresent()){if(a){p(`Set to always open notes, getting current ${n} note`);let w=i.getCurrent();await this.handleClose(e,i,w),await this.handleOpen(e,w,n)}}else{let w=c?`Current ${n}`:`Today's ${n}`;p(`Creating new ${n} note`);let N=await i.create();new X.Notice(`${w} note has been created.`,5e3),await this.handleClose(e,i,N),await this.handleOpen(e,N,n),o&&await ke(this.app,N,!0)}}getOpenWorkspaceLeaves(){return Object.keys(this.workspaceLeaves).length||(this.workspace.iterateAllLeaves(e=>{var a,o,l,c;let i=(o=(a=e.view)==null?void 0:a.getViewType)==null?void 0:o.call(a),n=(c=(l=e.view)==null?void 0:l.getState)==null?void 0:c.call(l);p(`Leaf found - viewType: ${i}, state.file: ${n==null?void 0:n.file}`),(i==="markdown"||i===void 0)&&n&&typeof n.file!="undefined"&&(this.workspaceLeaves[n.file]=e)}),p(`Found ${Object.keys(this.workspaceLeaves).length} actual file tabs open: ${Object.keys(this.workspaceLeaves).join(", ")}`)),this.workspaceLeaves}async handleClose(e,i,n){if(e.closeExisting){p("Checking for any existing notes to close");let a=i.getAllPaths(),o=[];Object.entries(this.getOpenWorkspaceLeaves()).forEach(([l,c])=>{a.indexOf(l)>-1&&l!==n.path&&o.push(c)}),p("Found "+o.length+" tab(s) to close");for(let l of o)l.detach();await new Promise(l=>setTimeout(l,this.waitTimeout))}}async handleUnpin(e,i,n){if(e.unpinOldDailyNotes){p("Unpinning all old daily notes");let o=i.getAllPaths(),l=[];Object.entries(this.getOpenWorkspaceLeaves()).forEach(([c,g])=>{o.indexOf(c)>-1&&c!==n.path&&l.push(g)}),p(`Found ${l.length} daily note tab(s) to unpin`);for(let c of l)c.setPinned(!1)}}async handleOpen(e,i,n){var l,c,g,y;let a=this.getOpenWorkspaceLeaves(),o=Object.keys(a).indexOf(i.path)!==-1;if(p(`handleOpen called: openAndPin=${e.openAndPin}, notePath=${i.path}, isAlreadyOpen=${o}, openLeavesCount=${Object.keys(a).length}`),e.openAndPin&&!o){p("Opening note in new tab");let w=n==="daily"&&"openAtFirstPosition"in e&&e.openAtFirstPosition,N;if(w){this.plugin.setDailyNoteCreation(!0);try{N=this.workspace.getLeaf("tab"),p("Used monkey patch to create daily note leaf at first position")}finally{this.plugin.setDailyNoteCreation(!1)}}else N=this.workspace.getLeaf(!0);if(await N.openFile(i),p(`Before setPinned - leaf parent has ${((c=(l=N.parent)==null?void 0:l.children)==null?void 0:c.length)||0} children`),N.setPinned(!0),p(`After setPinned - leaf parent has ${((y=(g=N.parent)==null?void 0:g.children)==null?void 0:y.length)||0} children`),w){let P=N.parent;if(P&&P.children){let f=P.children.indexOf(N);p(`Daily note leaf is at index ${f} after pinning, moving to index 0`),f>0&&(P.children.splice(f,1),P.children.unshift(N),P.recomputeChildrenDimensions(),p("Moved daily note leaf to first position"))}}}}isEmptyLeaf(e){let i=e.view.getViewType();return["empty","home-tab-view"].includes(i)}};var Ne=Object.freeze({available:!1,enabled:!1,closeExisting:!1,openAndPin:!1}),Z=Object.freeze({alwaysOpen:!1,processTemplater:!1,debug:!1,daily:{...Ne,excludeWeekends:!1,openAtFirstPosition:!1,enableAdvancedScheduling:!1,scheduledTime:"22:00",createTomorrowsNote:!1,unpinOldDailyNotes:!1},weekly:{...Ne},monthly:{...Ne},quarterly:{...Ne},yearly:{...Ne},deviceSettings:{}});function St(t){var i,n,a,o;return{alwaysOpen:(i=t==null?void 0:t.alwaysOpen)!=null?i:Z.alwaysOpen,processTemplater:(n=t==null?void 0:t.processTemplater)!=null?n:Z.processTemplater,debug:(a=t==null?void 0:t.debug)!=null?a:Z.debug,daily:{...Z.daily,...t==null?void 0:t.daily},weekly:{...Z.weekly,...t==null?void 0:t.weekly},monthly:{...Z.monthly,...t==null?void 0:t.monthly},quarterly:{...Z.quarterly,...t==null?void 0:t.quarterly},yearly:{...Z.yearly,...t==null?void 0:t.yearly},deviceSettings:(o=t==null?void 0:t.deviceSettings)!=null?o:{}}}var L=require("obsidian"),ve=class extends L.PluginSettingTab{constructor(e,i){super(e,i),this.plugin=i}display(){var a,o;this.containerEl.empty();let e=this.plugin.settings,i=["daily","weekly","monthly","quarterly","yearly"];if(!e.daily.available&&!e.weekly.available&&!e.monthly.available&&!e.quarterly.available&&!e.yearly.available){let l=this.containerEl.createDiv({cls:"settings-banner"});new L.Setting(l).setName("No periodic notes enabled").setHeading().setDesc("No periodic notes settings are enabled. You must turn on one of daily, weekly, monthly, quarterly or yearly notes within the Periodic Notes plugin settings to be able to configure them to generate automatically.")}this.containerEl.createEl("h3",{text:"General settings"}),new L.Setting(this.containerEl).setName("Enable debug logging").setDesc("Enable detailed debug logging in the developer console.").addToggle(l=>{l.setValue(e.debug).onChange(async c=>{e.debug=c,await this.plugin.updateSettings(e)})}),new L.Setting(this.containerEl).setName("Always open periodic notes").setDesc("Always open your periodic notes even when they haven't just been created.").addToggle(l=>{l.setValue(e.alwaysOpen).onChange(async c=>{e.alwaysOpen=c,await this.plugin.updateSettings(e)})}),!!((o=(a=this.app.plugins)==null?void 0:a.plugins)!=null&&o["templater-obsidian"])&&new L.Setting(this.containerEl).setName("Process Templater code in automatically created notes").setDesc("Automatically process Templater syntax from notes created in the background.").addToggle(l=>{l.setValue(e.processTemplater).onChange(async c=>{e.processTemplater=c,await this.plugin.updateSettings(e)})});for(let l of i)e[l].available&&this.renderPeriodicitySection(l,e)}renderPeriodicitySection(e,i){let n=e==="daily";this.containerEl.createEl("h3",{text:`Automatic ${e} notes`}),new L.Setting(this.containerEl).setName(`Enable automatic ${e} notes`).setDesc(`Create new ${e} notes automatically using periodic notes location and template.`).addToggle(a=>{a.setValue(i[e].enabled).onChange(async o=>{i[e].enabled=o,await this.plugin.updateSettings(i)})}),n&&new L.Setting(this.containerEl).setName("Exclude weekends").setDesc("Skip creating daily notes on Saturdays and Sundays.").addToggle(a=>{a.setValue(i.daily.excludeWeekends).onChange(async o=>{i.daily.excludeWeekends=o,await this.plugin.updateSettings(i)})}),new L.Setting(this.containerEl).setName(`Open and pin new ${e} notes`).setDesc("Automatically open and pin the new note to your tabs.").addToggle(a=>{a.setValue(i[e].openAndPin).onChange(async o=>{i[e].openAndPin=o,await this.plugin.updateSettings(i)})}),n&&new L.Setting(this.containerEl).setName("Open daily notes at first position").setDesc("Position new daily note tabs at the first position.").addToggle(a=>{a.setValue(i.daily.openAtFirstPosition).onChange(async o=>{i.daily.openAtFirstPosition=o,await this.plugin.updateSettings(i)})}),new L.Setting(this.containerEl).setName(`Close older ${e} notes`).setDesc(n?"Close older open daily notes on startup (not at custom scheduled time).":`Automatically close any older open ${e} notes.`).addToggle(a=>{a.setValue(i[e].closeExisting).onChange(async o=>{i[e].closeExisting=o,await this.plugin.updateSettings(i)})}),n&&this.renderDailyAdvancedSection(i)}renderDailyAdvancedSection(e){let i=this.containerEl.createEl("details",{cls:"setting-item-details"});i.createEl("summary",{text:"Advanced: Custom Scheduled Time",cls:"setting-item-heading"});let n=i.createDiv({cls:"setting-item-details-content"});if(new L.Setting(n).setName("Enable custom scheduled time").setDesc("Schedule an additional daily check at a custom time (e.g., 22:30 to create tomorrow's note before sleep).").addToggle(a=>{a.setValue(e.daily.enableAdvancedScheduling).onChange(async o=>{e.daily.enableAdvancedScheduling=o,await this.plugin.updateSettings(e),this.display()})}),e.daily.enableAdvancedScheduling){let a=this.plugin.getDeviceId(),o=this.plugin.getDeviceScheduledTime();new L.Setting(n).setName(`Scheduled time (${a})`).setDesc("Time for the custom check (24-hour format). This setting is device-specific and will not affect other devices.").addText(l=>{l.setPlaceholder("HH:mm (e.g., 22:30)").setValue(o).onChange(async c=>{/^([01]\d|2[0-3]):([0-5]\d)$/.test(c)||c===""?await this.plugin.setDeviceScheduledTime(c||"22:00"):new L.Notice("Invalid time format. Use HH:mm (e.g., 22:30)")})}),new L.Setting(n).setName("Create tomorrow's daily note").setDesc("At the custom scheduled time, create tomorrow's note instead of today's.").addToggle(l=>{l.setValue(e.daily.createTomorrowsNote).onChange(async c=>{e.daily.createTomorrowsNote=c,await this.plugin.updateSettings(e)})}),new L.Setting(n).setName("Unpin old daily notes").setDesc("At the custom scheduled time, unpin old daily notes instead of closing them.").addToggle(l=>{l.setValue(e.daily.unpinOldDailyNotes).onChange(async c=>{e.daily.unpinOldDailyNotes=c,await this.plugin.updateSettings(e)})})}}};var Ae=class extends V.Plugin{constructor(i,n){super(i,n);this.isDailyNoteCreation=!1;this.scheduledTimeouts={scheduledTime:null};this.settings={},this.periodicNotesPlugin=new Se.PeriodicNotesPluginAdapter(i),this.notes=new we(i.workspace,i,this)}async onload(){this.updateSettings=this.updateSettings.bind(this),await this.loadSettings(),this.setupWorkspacePatches(),this.app.workspace.onLayoutReady(this.onLayoutReady.bind(this))}onLayoutReady(){if(!this.periodicNotesPlugin.isEnabled()){new V.Notice("The Periodic Notes plugin must be installed and available for Auto Periodic Notes to work.",1e4);return}let i=this.app.workspace;this.registerEvent(i.on(Se.PERIODIC_NOTES_EVENT_SETTING_UPDATED,this.syncPeriodicNotesSettings.bind(this))),this.syncPeriodicNotesSettings(),this.addSettingTab(new ve(this.app,this)),this.notes.checkAndCreateNotes(this.settings,{scheduleName:"startup"}).then(()=>this.checkMissedScheduledTaskOnStartup()).catch(n=>{p(`Error during startup check: ${n.message}`),console.error("Auto Periodic Notes: Failed to create notes on startup",n),new V.Notice("Auto Periodic Notes: Failed to create notes on startup. Check console for details.")}),this.scheduleAllDailyChecks(),this.register(this.clearAllScheduledTimeouts.bind(this)),this.setupVisibilityListener()}async loadSettings(){this.settings=St(await this.loadData()),Le(this.settings.debug),p("Loaded settings: "+JSON.stringify(this.settings))}async updateSettings(i){this.settings=i,Le(this.settings.debug),await this.saveData(this.settings),this.onSettingsUpdate(),this.scheduleDailyCheck(),p("Saved settings: "+JSON.stringify(this.settings))}syncPeriodicNotesSettings(){p("Received new settings from Periodic Notes plugin");let i=this.periodicNotesPlugin.convertSettings();this.settings.daily.available=i.daily.available,this.settings.weekly.available=i.weekly.available,this.settings.monthly.available=i.monthly.available,this.settings.quarterly.available=i.quarterly.available,this.settings.yearly.available=i.yearly.available,this.updateSettings(this.settings)}onSettingsUpdate(){this.app.workspace.trigger(ut)}setupWorkspacePatches(){let i=this;this.monkeyPatchCleanup=dt(V.Workspace.prototype,{getLeaf:n=>function(a){return i.isDailyNoteCreation&&i.settings.daily.openAtFirstPosition?(p("Intercepted getLeaf call for daily note - creating at first position"),i.createLeafAtFirstPosition()):n.call(this,a)}}),this.register(()=>{this.monkeyPatchCleanup&&(this.monkeyPatchCleanup(),p("Cleaned up monkey patch"))})}createLeafAtFirstPosition(){let i=this.app.workspace.getMostRecentLeaf();if(!i){let o=this.isDailyNoteCreation;this.isDailyNoteCreation=!1;let l=this.app.workspace.getLeaf("tab");return this.isDailyNoteCreation=o,l}let n=i.parent,a=n.children;if(a&&a.length>0){let o=a[0],l=o.view.getViewType();if(["empty","home-tab-view"].includes(l))return p("Reusing empty leaf at first position"),o}try{let o=new V.WorkspaceLeaf(this.app);return n.insertChild(0,o),p("Created new leaf at first position via monkey patch"),o}catch(o){p("Failed to create leaf at first position, using fallback: "+o);let l=this.isDailyNoteCreation;this.isDailyNoteCreation=!1;let c=this.app.workspace.getLeaf("tab");return this.isDailyNoteCreation=l,c}}setDailyNoteCreation(i){this.isDailyNoteCreation=i}getDeviceId(){return Ot.hostname()}getDeviceScheduledTime(){var n,a,o,l;let i=this.getDeviceId();return(l=(o=(a=(n=this.settings.deviceSettings)==null?void 0:n[i])==null?void 0:a.scheduledTime)!=null?o:this.settings.daily.scheduledTime)!=null?l:""}async setDeviceScheduledTime(i){let n=this.getDeviceId();this.settings.deviceSettings||(this.settings.deviceSettings={}),this.settings.deviceSettings[n]||(this.settings.deviceSettings[n]={scheduledTime:""}),this.settings.deviceSettings[n].scheduledTime=i,await this.saveData(this.settings),this.onSettingsUpdate(),p(`Device ${n} scheduled time changed to ${i}, rescheduling...`),this.scheduleDailyCheck()}getLastExecutionDate(){var n,a,o;let i=this.getDeviceId();return(o=(a=(n=this.settings.deviceSettings)==null?void 0:n[i])==null?void 0:a.lastExecutionDate)!=null?o:null}async setLastExecutionDate(i){let n=this.getDeviceId();this.settings.deviceSettings||(this.settings.deviceSettings={}),this.settings.deviceSettings[n]||(this.settings.deviceSettings[n]={scheduledTime:""}),this.settings.deviceSettings[n].lastExecutionDate=i,await this.saveData(this.settings)}scheduleDailyCheck(){let i=this.settings.daily,n=this.getDeviceScheduledTime(),a=this.getDeviceId();if(p(`[scheduledTime] Checking settings for device ${a}: enableAdvancedScheduling=${i.enableAdvancedScheduling}, scheduledTime=${n}`),!i.enableAdvancedScheduling||!n){p("[scheduledTime] Not scheduling - conditions not met"),this.clearScheduledTimeout("scheduledTime");return}if(!/^([01]\d|2[0-3]):([0-5]\d)$/.test(n)){p(`[scheduledTime] Not scheduling - invalid time format: ${n}`),this.clearScheduledTimeout("scheduledTime");return}this.clearScheduledTimeout("scheduledTime");let l=new Date,c=new Date(l),[g,y]=this.parseScheduledTime(n);c.setHours(g,y,0,0),c<=l&&c.setDate(c.getDate()+1);let w=c.getTime()-l.getTime(),N=c.getTime();p(`[scheduledTime] Scheduled for ${c.toISOString()} (in ${w}ms)`),this.scheduledTimeouts.scheduledTime=window.setTimeout(async()=>{try{let P=Date.now(),f=Math.abs(P-N),F=5*60*1e3;if(f>F){p(`[scheduledTime] Skipped - triggered ${Math.round(f/1e3/60)}min away from target (likely sleep recovery)`),this.scheduleDailyCheck();return}await this.executeCustomScheduledTask(!0)}catch(P){p(`Error in scheduledTime: ${P.message}`),console.error("Auto Periodic Notes: Failed during custom scheduled check",P),new V.Notice("Auto Periodic Notes: Failed to create notes at scheduled time. Check console for details.")}finally{this.scheduleDailyCheck()}},w)}scheduleAllDailyChecks(){this.scheduleDailyCheck()}setupVisibilityListener(){p("[Visibility] Setting up visibility change listener");let i=async()=>{document.hidden||(p("[Visibility] Window became visible, checking for missed schedules"),console.log("[Auto Periodic Notes] Window became visible, checking scheduled tasks..."),await this.onWindowBecameVisible())};document.addEventListener("visibilitychange",i),this.register(()=>{document.removeEventListener("visibilitychange",i),p("[Visibility] Visibility listener removed")}),p("[Visibility] Visibility listener registered")}async onWindowBecameVisible(){if(!this.settings.daily.enableAdvancedScheduling){p("[Visibility] Advanced scheduling not enabled, skipping");return}let i=this.getDeviceScheduledTime();if(!i){p("[Visibility] No scheduled time configured, skipping");return}let n=new Date,a=n.toISOString().split("T")[0],[o,l]=this.parseScheduledTime(i),c=new Date(n);c.setHours(o,l,0,0);let g=n.getTime(),y=c.getTime();p(`[Visibility] Checking: now=${n.toISOString()}, target=${c.toISOString()}, lastExecution=${this.getLastExecutionDate()}`),g<y?(p("[Visibility] Before scheduled time, ensuring timeout is set"),console.log(`[Auto Periodic Notes] Before scheduled time ${i}, rescheduling...`),this.scheduleDailyCheck()):this.getLastExecutionDate()!==a?(p("[Visibility] After scheduled time and not executed today, triggering now"),console.log(`[Auto Periodic Notes] Missed scheduled time ${i}, executing now...`),await this.executeCustomScheduledTask(!1)):(p("[Visibility] After scheduled time but already executed today, skipping"),console.log(`[Auto Periodic Notes] Already executed today at ${i}, skipping`))}async executeCustomScheduledTask(i=!0){let n=new Date,a=n.toISOString().split("T")[0];try{console.log(`[Auto Periodic Notes] Executing scheduled task at ${n.toLocaleTimeString()} (${i?"on-time":"late"})`),console.log("[Auto Periodic Notes] Creating next period notes (tomorrow)"),await this.notes.checkAndCreateNextPeriodNotes(this.settings,{scheduleName:"scheduledTime"}),await this.setLastExecutionDate(a),p(`[Execution] Marked and persisted execution date: ${a}`),console.log("[Auto Periodic Notes] Scheduled task completed successfully")}catch(o){p(`Error during scheduled task: ${o.message}`),console.error("Auto Periodic Notes: Failed to execute scheduled task",o),new V.Notice("Auto Periodic Notes: Failed to create notes. Check console for details.")}}async checkMissedScheduledTaskOnStartup(){if(!this.settings.daily.enableAdvancedScheduling){p("[Startup Recovery] Advanced scheduling not enabled, skipping");return}let i=this.getDeviceScheduledTime();if(!i){p("[Startup Recovery] No scheduled time configured, skipping");return}let n=new Date,a=n.toISOString().split("T")[0],[o,l]=this.parseScheduledTime(i),c=new Date(n);c.setHours(o,l,0,0);let g=n.getTime(),y=c.getTime();p(`[Startup Recovery] Checking: now=${n.toISOString()}, target=${c.toISOString()}, lastExecution=${this.getLastExecutionDate()}`),g>y?this.getLastExecutionDate()!==a?(p("[Startup Recovery] Missed scheduled task detected, executing now"),console.log(`[Auto Periodic Notes] Startup recovery: missed scheduled time ${i}, executing now...`),await this.executeCustomScheduledTask(!1)):p("[Startup Recovery] Already executed today, skipping"):p("[Startup Recovery] Before scheduled time, no recovery needed")}parseScheduledTime(i){let n=i.match(/^([01]\d|2[0-3]):([0-5]\d)$/);return n?[parseInt(n[1],10),parseInt(n[2],10)]:(p(`Invalid scheduled time: ${i}, using default 00:00`),[0,2])}clearScheduledTimeout(i){this.scheduledTimeouts[i]!==null&&(window.clearTimeout(this.scheduledTimeouts[i]),this.scheduledTimeouts[i]=null,p(`Cleared timeout: ${i}`))}clearAllScheduledTimeouts(){Object.keys(this.scheduledTimeouts).forEach(i=>{this.clearScheduledTimeout(i)})}};
