/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the GitHub repository of this plugin.
*/

var Xt=Object.create;var De=Object.defineProperty;var Zt=Object.getOwnPropertyDescriptor;var ei=Object.getOwnPropertyNames;var ti=Object.getPrototypeOf,ii=Object.prototype.hasOwnProperty;var Ke=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ai=(t,e)=>{for(var i in e)De(t,i,{get:e[i],enumerable:!0})},Je=(t,e,i,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ei(e))!ii.call(t,n)&&n!==i&&De(t,n,{get:()=>e[n],enumerable:!(a=Zt(e,n))||a.enumerable});return t};var Ae=(t,e,i)=>(i=t!=null?Xt(ti(t)):{},Je(e||!t||!t.__esModule?De(i,"default",{value:t,enumerable:!0}):i,t)),ni=t=>Je(De({},"__esModule",{value:!0}),t);var Le=Ke((ra,dt)=>{var oi=Object.create,Se=Object.defineProperty,ri=Object.getOwnPropertyDescriptor,li=Object.getOwnPropertyNames,si=Object.getPrototypeOf,ci=Object.prototype.hasOwnProperty,di=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ui=(t,e)=>{for(var i in e)Se(t,i,{get:e[i],enumerable:!0})},at=(t,e,i,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of li(e))!ci.call(t,n)&&n!==i&&Se(t,n,{get:()=>e[n],enumerable:!(a=ri(e,n))||a.enumerable});return t},ue=(t,e,i)=>(i=t!=null?oi(si(t)):{},at(e||!t||!t.__esModule?Se(i,"default",{value:t,enumerable:!0}):i,t)),gi=t=>at(Se({},"__esModule",{value:!0}),t),ge=di(t=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e=require("obsidian"),i="YYYY-MM-DD",a="gggg-[W]ww",n="YYYY-MM",o="YYYY-[Q]Q",r="YYYY";function c(l){var s,d;let g=window.app.plugins.getPlugin("periodic-notes");return g&&((d=(s=g.settings)==null?void 0:s[l])==null?void 0:d.enabled)}function p(){var l,s,d,g;try{let{internalPlugins:y,plugins:m}=window.app;if(c("daily")){let{format:S,folder:x,template:U}=((s=(l=m.getPlugin("periodic-notes"))==null?void 0:l.settings)==null?void 0:s.daily)||{};return{format:S||i,folder:(x==null?void 0:x.trim())||"",template:(U==null?void 0:U.trim())||""}}let{folder:O,format:F,template:$}=((g=(d=y.getPluginById("daily-notes"))==null?void 0:d.instance)==null?void 0:g.options)||{};return{format:F||i,folder:(O==null?void 0:O.trim())||"",template:($==null?void 0:$.trim())||""}}catch(y){console.info("No custom daily note settings found!",y)}}function w(){var l,s,d,g,y,m,O;try{let F=window.app.plugins,$=(l=F.getPlugin("calendar"))==null?void 0:l.options,S=(d=(s=F.getPlugin("periodic-notes"))==null?void 0:s.settings)==null?void 0:d.weekly;if(c("weekly"))return{format:S.format||a,folder:((g=S.folder)==null?void 0:g.trim())||"",template:((y=S.template)==null?void 0:y.trim())||""};let x=$||{};return{format:x.weeklyNoteFormat||a,folder:((m=x.weeklyNoteFolder)==null?void 0:m.trim())||"",template:((O=x.weeklyNoteTemplate)==null?void 0:O.trim())||""}}catch(F){console.info("No custom weekly note settings found!",F)}}function k(){var l,s,d,g;let y=window.app.plugins;try{let m=c("monthly")&&((s=(l=y.getPlugin("periodic-notes"))==null?void 0:l.settings)==null?void 0:s.monthly)||{};return{format:m.format||n,folder:((d=m.folder)==null?void 0:d.trim())||"",template:((g=m.template)==null?void 0:g.trim())||""}}catch(m){console.info("No custom monthly note settings found!",m)}}function T(){var l,s,d,g;let y=window.app.plugins;try{let m=c("quarterly")&&((s=(l=y.getPlugin("periodic-notes"))==null?void 0:l.settings)==null?void 0:s.quarterly)||{};return{format:m.format||o,folder:((d=m.folder)==null?void 0:d.trim())||"",template:((g=m.template)==null?void 0:g.trim())||""}}catch(m){console.info("No custom quarterly note settings found!",m)}}function N(){var l,s,d,g;let y=window.app.plugins;try{let m=c("yearly")&&((s=(l=y.getPlugin("periodic-notes"))==null?void 0:l.settings)==null?void 0:s.yearly)||{};return{format:m.format||r,folder:((d=m.folder)==null?void 0:d.trim())||"",template:((g=m.template)==null?void 0:g.trim())||""}}catch(m){console.info("No custom yearly note settings found!",m)}}function A(...l){let s=[];for(let g=0,y=l.length;g<y;g++)s=s.concat(l[g].split("/"));let d=[];for(let g=0,y=s.length;g<y;g++){let m=s[g];!m||m==="."||d.push(m)}return s[0]===""&&d.unshift(""),d.join("/")}function Y(l){let s=l.substring(l.lastIndexOf("/")+1);return s.lastIndexOf(".")!=-1&&(s=s.substring(0,s.lastIndexOf("."))),s}async function h(l){let s=l.replace(/\\/g,"/").split("/");if(s.pop(),s.length){let d=A(...s);window.app.vault.getAbstractFileByPath(d)||await window.app.vault.createFolder(d)}}async function D(l,s){s.endsWith(".md")||(s+=".md");let d=e.normalizePath(A(l,s));return await h(d),d}async function b(l){let{metadataCache:s,vault:d}=window.app,g=e.normalizePath(l);if(g==="/")return Promise.resolve(["",null]);try{let y=s.getFirstLinkpathDest(g,""),m=await d.cachedRead(y),O=window.app.foldManager.load(y);return[m,O]}catch(y){return console.error(`Failed to read the daily note template '${g}'`,y),new e.Notice("Failed to read the daily note template"),["",null]}}function P(l,s="day"){let d=l.clone().startOf(s).format();return`${s}-${d}`}function C(l){return l.replace(/\[[^\]]*\]/g,"")}function W(l,s){if(s==="week"){let d=C(l);return/w{1,2}/i.test(d)&&(/M{1,4}/.test(d)||/D{1,4}/.test(d))}return!1}function q(l,s){return H(l.basename,s)}function ie(l,s){return H(Y(l),s)}function H(l,s){let d={day:p,week:w,month:k,quarter:T,year:N}[s]().format.split("/").pop(),g=window.moment(l,d,!0);if(!g.isValid())return null;if(W(d,s)&&s==="week"){let y=C(d);if(/w{1,2}/i.test(y))return window.moment(l,d.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return g}var Et=class extends Error{};async function He(l){let s=window.app,{vault:d}=s,g=window.moment,{template:y,format:m,folder:O}=p(),[F,$]=await b(y),S=l.format(m),x=await D(O,S);try{let U=await d.create(x,F.replace(/{{\s*date\s*}}/gi,S).replace(/{{\s*time\s*}}/gi,g().format("HH:mm")).replace(/{{\s*title\s*}}/gi,S).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(j,z,ee,V,_,I)=>{let Ee=g(),Ce=l.clone().set({hour:Ee.get("hour"),minute:Ee.get("minute"),second:Ee.get("second")});return ee&&Ce.add(parseInt(V,10),_),I?Ce.format(I.substring(1).trim()):Ce.format(m)}).replace(/{{\s*yesterday\s*}}/gi,l.clone().subtract(1,"day").format(m)).replace(/{{\s*tomorrow\s*}}/gi,l.clone().add(1,"d").format(m)));return s.foldManager.save(U,$),U}catch(U){console.error(`Failed to create file: '${x}'`,U),new e.Notice("Unable to create new file.")}}function Ct(l,s){var d;return(d=s[P(l,"day")])!=null?d:null}function $t(){let{vault:l}=window.app,{folder:s}=p(),d=l.getAbstractFileByPath(e.normalizePath(s));if(!d)throw new Et("Failed to find daily notes folder");let g={};return e.Vault.recurseChildren(d,y=>{if(y instanceof e.TFile){let m=q(y,"day");if(m){let O=P(m,"day");g[O]=y}}}),g}var It=class extends Error{};function Lt(){let{moment:l}=window,s=l.localeData()._week.dow,d=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;s;)d.push(d.shift()),s--;return d}function _t(l){return Lt().indexOf(l.toLowerCase())}async function Re(l){let{vault:s}=window.app,{template:d,format:g,folder:y}=w(),[m,O]=await b(d),F=l.format(g),$=await D(y,F);try{let S=await s.create($,m.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(x,U,j,z,ee,V)=>{let _=window.moment(),I=l.clone().set({hour:_.get("hour"),minute:_.get("minute"),second:_.get("second")});return j&&I.add(parseInt(z,10),ee),V?I.format(V.substring(1).trim()):I.format(g)}).replace(/{{\s*title\s*}}/gi,F).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(x,U,j)=>{let z=_t(U);return l.weekday(z).format(j.trim())}));return window.app.foldManager.save(S,O),S}catch(S){console.error(`Failed to create file: '${$}'`,S),new e.Notice("Unable to create new file.")}}function Yt(l,s){var d;return(d=s[P(l,"week")])!=null?d:null}function Mt(){let l={};if(!je())return l;let{vault:s}=window.app,{folder:d}=w(),g=s.getAbstractFileByPath(e.normalizePath(d));if(!g)throw new It("Failed to find weekly notes folder");return e.Vault.recurseChildren(g,y=>{if(y instanceof e.TFile){let m=q(y,"week");if(m){let O=P(m,"week");l[O]=y}}}),l}var xt=class extends Error{};async function Qe(l){let{vault:s}=window.app,{template:d,format:g,folder:y}=k(),[m,O]=await b(d),F=l.format(g),$=await D(y,F);try{let S=await s.create($,m.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(x,U,j,z,ee,V)=>{let _=window.moment(),I=l.clone().set({hour:_.get("hour"),minute:_.get("minute"),second:_.get("second")});return j&&I.add(parseInt(z,10),ee),V?I.format(V.substring(1).trim()):I.format(g)}).replace(/{{\s*date\s*}}/gi,F).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,F));return window.app.foldManager.save(S,O),S}catch(S){console.error(`Failed to create file: '${$}'`,S),new e.Notice("Unable to create new file.")}}function Wt(l,s){var d;return(d=s[P(l,"month")])!=null?d:null}function qt(){let l={};if(!ze())return l;let{vault:s}=window.app,{folder:d}=k(),g=s.getAbstractFileByPath(e.normalizePath(d));if(!g)throw new xt("Failed to find monthly notes folder");return e.Vault.recurseChildren(g,y=>{if(y instanceof e.TFile){let m=q(y,"month");if(m){let O=P(m,"month");l[O]=y}}}),l}var Ut=class extends Error{};async function Vt(l){let{vault:s}=window.app,{template:d,format:g,folder:y}=T(),[m,O]=await b(d),F=l.format(g),$=await D(y,F);try{let S=await s.create($,m.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(x,U,j,z,ee,V)=>{let _=window.moment(),I=l.clone().set({hour:_.get("hour"),minute:_.get("minute"),second:_.get("second")});return j&&I.add(parseInt(z,10),ee),V?I.format(V.substring(1).trim()):I.format(g)}).replace(/{{\s*date\s*}}/gi,F).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,F));return window.app.foldManager.save(S,O),S}catch(S){console.error(`Failed to create file: '${$}'`,S),new e.Notice("Unable to create new file.")}}function Ht(l,s){var d;return(d=s[P(l,"quarter")])!=null?d:null}function Rt(){let l={};if(!Be())return l;let{vault:s}=window.app,{folder:d}=T(),g=s.getAbstractFileByPath(e.normalizePath(d));if(!g)throw new Ut("Failed to find quarterly notes folder");return e.Vault.recurseChildren(g,y=>{if(y instanceof e.TFile){let m=q(y,"quarter");if(m){let O=P(m,"quarter");l[O]=y}}}),l}var Qt=class extends Error{};async function jt(l){let{vault:s}=window.app,{template:d,format:g,folder:y}=N(),[m,O]=await b(d),F=l.format(g),$=await D(y,F);try{let S=await s.create($,m.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(x,U,j,z,ee,V)=>{let _=window.moment(),I=l.clone().set({hour:_.get("hour"),minute:_.get("minute"),second:_.get("second")});return j&&I.add(parseInt(z,10),ee),V?I.format(V.substring(1).trim()):I.format(g)}).replace(/{{\s*date\s*}}/gi,F).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,F));return window.app.foldManager.save(S,O),S}catch(S){console.error(`Failed to create file: '${$}'`,S),new e.Notice("Unable to create new file.")}}function zt(l,s){var d;return(d=s[P(l,"year")])!=null?d:null}function Bt(){let l={};if(!Ge())return l;let{vault:s}=window.app,{folder:d}=N(),g=s.getAbstractFileByPath(e.normalizePath(d));if(!g)throw new Qt("Failed to find yearly notes folder");return e.Vault.recurseChildren(g,y=>{if(y instanceof e.TFile){let m=q(y,"year");if(m){let O=P(m,"year");l[O]=y}}}),l}function Gt(){var l,s;let{app:d}=window,g=d.internalPlugins.plugins["daily-notes"];if(g&&g.enabled)return!0;let y=d.plugins.getPlugin("periodic-notes");return y&&((s=(l=y.settings)==null?void 0:l.daily)==null?void 0:s.enabled)}function je(){var l,s;let{app:d}=window;if(d.plugins.getPlugin("calendar"))return!0;let g=d.plugins.getPlugin("periodic-notes");return g&&((s=(l=g.settings)==null?void 0:l.weekly)==null?void 0:s.enabled)}function ze(){var l,s;let{app:d}=window,g=d.plugins.getPlugin("periodic-notes");return g&&((s=(l=g.settings)==null?void 0:l.monthly)==null?void 0:s.enabled)}function Be(){var l,s;let{app:d}=window,g=d.plugins.getPlugin("periodic-notes");return g&&((s=(l=g.settings)==null?void 0:l.quarterly)==null?void 0:s.enabled)}function Ge(){var l,s;let{app:d}=window,g=d.plugins.getPlugin("periodic-notes");return g&&((s=(l=g.settings)==null?void 0:l.yearly)==null?void 0:s.enabled)}function Kt(l){let s={day:p,week:w,month:k,quarter:T,year:N}[l];return s()}function Jt(l,s){return{day:He,month:Qe,week:Re}[l](s)}t.DEFAULT_DAILY_NOTE_FORMAT=i,t.DEFAULT_MONTHLY_NOTE_FORMAT=n,t.DEFAULT_QUARTERLY_NOTE_FORMAT=o,t.DEFAULT_WEEKLY_NOTE_FORMAT=a,t.DEFAULT_YEARLY_NOTE_FORMAT=r,t.appHasDailyNotesPluginLoaded=Gt,t.appHasMonthlyNotesPluginLoaded=ze,t.appHasQuarterlyNotesPluginLoaded=Be,t.appHasWeeklyNotesPluginLoaded=je,t.appHasYearlyNotesPluginLoaded=Ge,t.createDailyNote=He,t.createMonthlyNote=Qe,t.createPeriodicNote=Jt,t.createQuarterlyNote=Vt,t.createWeeklyNote=Re,t.createYearlyNote=jt,t.getAllDailyNotes=$t,t.getAllMonthlyNotes=qt,t.getAllQuarterlyNotes=Rt,t.getAllWeeklyNotes=Mt,t.getAllYearlyNotes=Bt,t.getDailyNote=Ct,t.getDailyNoteSettings=p,t.getDateFromFile=q,t.getDateFromPath=ie,t.getDateUID=P,t.getMonthlyNote=Wt,t.getMonthlyNoteSettings=k,t.getPeriodicNoteSettings=Kt,t.getQuarterlyNote=Ht,t.getQuarterlyNoteSettings=T,t.getTemplateInfo=b,t.getWeeklyNote=Yt,t.getWeeklyNoteSettings=w,t.getYearlyNote=zt,t.getYearlyNoteSettings=N}),nt={};ui(nt,{DEFAULT_SETTINGS:()=>Ie,DailyNote:()=>yi,MonthlyNote:()=>fi,PERIODIC_NOTES_EVENT_SETTING_UPDATED:()=>Ci,PLUGIN_NAME:()=>$e,PeriodicNotesPluginAdapter:()=>Ei,QuarterlyNote:()=>Ni,V0Provider:()=>ot,V1Provider:()=>ct,WeeklyNote:()=>vi,YearlyNote:()=>Pi,checkCreateTime:()=>se});dt.exports=gi(nt);var Xe=require("obsidian"),B=ue(ge()),pi=1e3,pe=class{};function se(t){return t.stat.ctime>new Date().getTime()-pi}var hi=30,ae="day",yi=class extends pe{constructor(){super(...arguments),this.date=(0,Xe.moment)()}getDate(){return(0,Xe.moment)().startOf(ae)}async create(){let t=this.date.clone().startOf(ae);return(0,B.createDailyNote)(t)}getAllPaths(){let t=(0,B.getAllDailyNotes)();return Object.entries(t).map(([e,i])=>i.path)}getCurrent(){return(0,B.getDailyNote)(this.date,(0,B.getAllDailyNotes)())}getNextDate(){return this.getDate().clone().add(1,ae)}getPrevious(){let t=this.getDate().clone().subtract(1,ae),e=t.clone().subtract(hi,ae),i=(0,B.getAllDailyNotes)(),a;do a=(0,B.getDailyNote)(t,i),t.subtract(1,ae);while(!a&&t.isAfter(e));return a}isPresent(){let t=this.date.clone().startOf(ae),e=(0,B.getAllDailyNotes)();return!!(0,B.getDailyNote)(t,e)}isValid(t){let e=(0,B.getDailyNote)(this.getDate(),(0,B.getAllDailyNotes)());return e?e.name===t.name&&se(e):!1}},Ze=require("obsidian"),G=ue(ge()),mi=12,ne="month",fi=class extends pe{constructor(){super(...arguments),this.date=(0,Ze.moment)()}getDate(){return(0,Ze.moment)().startOf(ne)}async create(){let t=this.date.clone().startOf(ne);return(0,G.createMonthlyNote)(t)}getAllPaths(){let t=(0,G.getAllMonthlyNotes)();return Object.entries(t).map(([e,i])=>i.path)}getCurrent(){return(0,G.getMonthlyNote)(this.date,(0,G.getAllMonthlyNotes)())}getNextDate(){return this.getDate().clone().add(1,ne)}getPrevious(){let t=this.getDate().clone().subtract(1,ne),e=t.clone().subtract(mi,ne),i=(0,G.getAllMonthlyNotes)(),a;do a=(0,G.getMonthlyNote)(t,i),t.subtract(1,ne);while(!a&&t.isAfter(e));return a}isPresent(){let t=this.date.clone().startOf(ne),e=(0,G.getAllMonthlyNotes)();return!!(0,G.getMonthlyNote)(t,e)}isValid(t){let e=(0,G.getMonthlyNote)(this.getDate(),(0,G.getAllMonthlyNotes)());return e?e.name===t.name&&se(e):!1}},et=require("obsidian"),K=ue(ge()),wi=4,oe="quarter",Ni=class extends pe{constructor(){super(...arguments),this.date=(0,et.moment)()}getDate(){return(0,et.moment)().startOf(oe)}async create(){let t=this.date.clone().startOf(oe);return(0,K.createQuarterlyNote)(t)}getAllPaths(){let t=(0,K.getAllQuarterlyNotes)();return Object.entries(t).map(([e,i])=>i.path)}getCurrent(){return(0,K.getQuarterlyNote)(this.date,(0,K.getAllQuarterlyNotes)())}getNextDate(){return this.getDate().clone().add(1,oe)}getPrevious(){let t=this.getDate().clone().subtract(1,oe),e=t.clone().subtract(wi,oe),i=(0,K.getAllQuarterlyNotes)(),a;do a=(0,K.getQuarterlyNote)(t,i),t.subtract(1,oe);while(!a&&t.isAfter(e));return a}isPresent(){let t=this.date.clone().startOf(oe),e=(0,K.getAllQuarterlyNotes)();return!!(0,K.getQuarterlyNote)(t,e)}isValid(t){let e=(0,K.getQuarterlyNote)(this.getDate(),(0,K.getAllQuarterlyNotes)());return e?e.name===t.name&&se(e):!1}},tt=require("obsidian"),J=ue(ge()),bi=8,re="week",vi=class extends pe{constructor(){super(...arguments),this.date=(0,tt.moment)()}getDate(){return(0,tt.moment)().startOf(re)}async create(){let t=this.date.clone().startOf(re);return(0,J.createWeeklyNote)(t)}getAllPaths(){let t=(0,J.getAllWeeklyNotes)();return Object.entries(t).map(([e,i])=>i.path)}getCurrent(){return(0,J.getWeeklyNote)(this.date,(0,J.getAllWeeklyNotes)())}getNextDate(){return this.getDate().clone().add(1,re)}getPrevious(){let t=this.getDate().clone().subtract(1,re),e=t.clone().subtract(bi,re),i=(0,J.getAllWeeklyNotes)(),a;do a=(0,J.getWeeklyNote)(t,i),t.subtract(1,re);while(!a&&t.isAfter(e));return a}isPresent(){let t=this.date.clone().startOf(re),e=(0,J.getAllWeeklyNotes)();return!!(0,J.getWeeklyNote)(t,e)}isValid(t){let e=(0,J.getWeeklyNote)(this.getDate(),(0,J.getAllWeeklyNotes)());return e?e.name===t.name&&se(e):!1}},it=require("obsidian"),X=ue(ge()),Ti=5,le="year",Pi=class extends pe{constructor(){super(...arguments),this.date=(0,it.moment)()}getDate(){return(0,it.moment)().startOf(le)}async create(){let t=this.date.clone().startOf(le);return(0,X.createYearlyNote)(t)}getAllPaths(){let t=(0,X.getAllYearlyNotes)();return Object.entries(t).map(([e,i])=>i.path)}getCurrent(){return(0,X.getYearlyNote)(this.date,(0,X.getAllYearlyNotes)())}getNextDate(){return this.getDate().clone().add(1,le)}getPrevious(){let t=this.getDate().clone().subtract(1,le),e=t.clone().subtract(Ti,le),i=(0,X.getAllYearlyNotes)(),a;do a=(0,X.getYearlyNote)(t,i),t.subtract(1,le);while(!a&&t.isAfter(e));return a}isPresent(){let t=this.date.clone().startOf(le),e=(0,X.getAllYearlyNotes)();return!!(0,X.getYearlyNote)(t,e)}isValid(t){let e=(0,X.getYearlyNote)(this.getDate(),(0,X.getAllYearlyNotes)());return e?e.name===t.name&&se(e):!1}},ot=class{convertSettings(t){let e=t,i=Object.assign({},Ie);return i.daily.available=e.daily.enabled,i.weekly.available=e.weekly.enabled,i.monthly.available=e.monthly.enabled,i.quarterly.available=e.quarterly.enabled,i.yearly.available=e.yearly.enabled,i}};function rt(){}function lt(t){return t()}function st(t){t.forEach(lt)}function ki(t){return typeof t=="function"}function Di(t){return Object.keys(t).length===0}function Ai(t,...e){if(t==null)return rt;let i=t.subscribe(...e);return i.unsubscribe?()=>i.unsubscribe():i}function Si(t){let e;return Ai(t,i=>e=i)(),e}var na=Promise.resolve(),oa=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function Oi(t,e){let i=t.$$;i.fragment!==null&&(st(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}var Fi;typeof HTMLElement=="function"&&(Fi=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){let{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(lt).filter(ki);for(let e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(t,e,i){this[t]=i}disconnectedCallback(){st(this.$$.on_disconnect)}$destroy(){Oi(this,1),this.$destroy=rt}$on(t,e){let i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(e),()=>{let a=i.indexOf(e);a!==-1&&i.splice(a,1)}}$set(t){this.$$set&&!Di(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});var ct=class{convertSettings(t){var e,i,a,n,o;let r=Si(t),c=r.calendarSets.filter(w=>w.id===r.activeCalendarSet),p=Object.assign({},Ie);return p.daily.available=!1,p.weekly.available=!1,p.monthly.available=!1,p.quarterly.available=!1,p.yearly.available=!1,c.length&&(p.daily.available=((e=c[0].day)==null?void 0:e.enabled)||!1,p.weekly.available=((i=c[0].week)==null?void 0:i.enabled)||!1,p.monthly.available=((a=c[0].month)==null?void 0:a.enabled)||!1,p.quarterly.available=((n=c[0].quarter)==null?void 0:n.enabled)||!1,p.yearly.available=((o=c[0].year)==null?void 0:o.enabled)||!1),p}},Ei=class{constructor(t){this.app=t}getProvider(){return this.getPlugin().settings.daily!==void 0?new ot:new ct}getPlugin(){return this.app.plugins.getPlugin($e)}isEnabled(){return this.app.plugins.enabledPlugins.has($e)}convertSettings(){return this.getProvider().convertSettings(this.getPlugin().settings)}},Ci="periodic-notes:settings-updated",$e="periodic-notes",Ie={daily:{available:!1},weekly:{available:!1},monthly:{available:!1},quarterly:{available:!1},yearly:{available:!1}}});var St=Ke(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});var E=require("obsidian"),Ye="YYYY-MM-DD",Me="gggg-[W]ww",ht="YYYY-MM",yt="YYYY-[Q]Q",mt="YYYY";function he(t){var i,a;let e=window.app.plugins.getPlugin("periodic-notes");return e&&((a=(i=e.settings)==null?void 0:i[t])==null?void 0:a.enabled)}function ye(){var t,e,i,a;try{let{internalPlugins:n,plugins:o}=window.app;if(he("daily")){let{format:w,folder:k,template:T}=((e=(t=o.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.daily)||{};return{format:w||Ye,folder:(k==null?void 0:k.trim())||"",template:(T==null?void 0:T.trim())||""}}let{folder:r,format:c,template:p}=((a=(i=n.getPluginById("daily-notes"))==null?void 0:i.instance)==null?void 0:a.options)||{};return{format:c||Ye,folder:(r==null?void 0:r.trim())||"",template:(p==null?void 0:p.trim())||""}}catch(n){console.info("No custom daily note settings found!",n)}}function me(){var t,e,i,a,n,o,r;try{let c=window.app.plugins,p=(t=c.getPlugin("calendar"))==null?void 0:t.options,w=(i=(e=c.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:i.weekly;if(he("weekly"))return{format:w.format||Me,folder:((a=w.folder)==null?void 0:a.trim())||"",template:((n=w.template)==null?void 0:n.trim())||""};let k=p||{};return{format:k.weeklyNoteFormat||Me,folder:((o=k.weeklyNoteFolder)==null?void 0:o.trim())||"",template:((r=k.weeklyNoteTemplate)==null?void 0:r.trim())||""}}catch(c){console.info("No custom weekly note settings found!",c)}}function fe(){var e,i,a,n;let t=window.app.plugins;try{let o=he("monthly")&&((i=(e=t.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:i.monthly)||{};return{format:o.format||ht,folder:((a=o.folder)==null?void 0:a.trim())||"",template:((n=o.template)==null?void 0:n.trim())||""}}catch(o){console.info("No custom monthly note settings found!",o)}}function we(){var e,i,a,n;let t=window.app.plugins;try{let o=he("quarterly")&&((i=(e=t.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:i.quarterly)||{};return{format:o.format||yt,folder:((a=o.folder)==null?void 0:a.trim())||"",template:((n=o.template)==null?void 0:n.trim())||""}}catch(o){console.info("No custom quarterly note settings found!",o)}}function Ne(){var e,i,a,n;let t=window.app.plugins;try{let o=he("yearly")&&((i=(e=t.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:i.yearly)||{};return{format:o.format||mt,folder:((a=o.folder)==null?void 0:a.trim())||"",template:((n=o.template)==null?void 0:n.trim())||""}}catch(o){console.info("No custom yearly note settings found!",o)}}function ft(...t){let e=[];for(let a=0,n=t.length;a<n;a++)e=e.concat(t[a].split("/"));let i=[];for(let a=0,n=e.length;a<n;a++){let o=e[a];!o||o==="."||i.push(o)}return e[0]===""&&i.unshift(""),i.join("/")}function Ii(t){let e=t.substring(t.lastIndexOf("/")+1);return e.lastIndexOf(".")!=-1&&(e=e.substring(0,e.lastIndexOf("."))),e}async function Li(t){let e=t.replace(/\\/g,"/").split("/");if(e.pop(),e.length){let i=ft(...e);window.app.vault.getAbstractFileByPath(i)||await window.app.vault.createFolder(i)}}async function be(t,e){e.endsWith(".md")||(e+=".md");let i=E.normalizePath(ft(t,e));return await Li(i),i}async function ce(t){let{metadataCache:e,vault:i}=window.app,a=E.normalizePath(t);if(a==="/")return Promise.resolve(["",null]);try{let n=e.getFirstLinkpathDest(a,""),o=await i.cachedRead(n),r=window.app.foldManager.load(n);return[o,r]}catch(n){return console.error(`Failed to read the daily note template '${a}'`,n),new E.Notice("Failed to read the daily note template"),["",null]}}function R(t,e="day"){let i=t.clone().startOf(e).format();return`${e}-${i}`}function wt(t){return t.replace(/\[[^\]]*\]/g,"")}function _i(t,e){if(e==="week"){let i=wt(t);return/w{1,2}/i.test(i)&&(/M{1,4}/.test(i)||/D{1,4}/.test(i))}return!1}function de(t,e){return Nt(t.basename,e)}function Yi(t,e){return Nt(Ii(t),e)}function Nt(t,e){let a={day:ye,week:me,month:fe,quarter:we,year:Ne}[e]().format.split("/").pop(),n=window.moment(t,a,!0);if(!n.isValid())return null;if(_i(a,e)&&e==="week"){let o=wt(a);if(/w{1,2}/i.test(o))return window.moment(t,a.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return n}var xe=class extends Error{};async function bt(t){let e=window.app,{vault:i}=e,a=window.moment,{template:n,format:o,folder:r}=ye(),[c,p]=await ce(n),w=t.format(o),k=await be(r,w);try{let T=await i.create(k,c.replace(/{{\s*date\s*}}/gi,w).replace(/{{\s*time\s*}}/gi,a().format("HH:mm")).replace(/{{\s*title\s*}}/gi,w).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(N,A,Y,h,D,b)=>{let P=a(),C=t.clone().set({hour:P.get("hour"),minute:P.get("minute"),second:P.get("second")});return Y&&C.add(parseInt(h,10),D),b?C.format(b.substring(1).trim()):C.format(o)}).replace(/{{\s*yesterday\s*}}/gi,t.clone().subtract(1,"day").format(o)).replace(/{{\s*tomorrow\s*}}/gi,t.clone().add(1,"d").format(o)));return e.foldManager.save(T,p),T}catch(T){console.error(`Failed to create file: '${k}'`,T),new E.Notice("Unable to create new file.")}}function Mi(t,e){var i;return(i=e[R(t,"day")])!=null?i:null}function xi(){let{vault:t}=window.app,{folder:e}=ye(),i=t.getAbstractFileByPath(E.normalizePath(e));if(!i)throw new xe("Failed to find daily notes folder");let a={};return E.Vault.recurseChildren(i,n=>{if(n instanceof E.TFile){let o=de(n,"day");if(o){let r=R(o,"day");a[r]=n}}}),a}var We=class extends Error{};function Wi(){let{moment:t}=window,e=t.localeData()._week.dow,i=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;e;)i.push(i.shift()),e--;return i}function qi(t){return Wi().indexOf(t.toLowerCase())}async function vt(t){let{vault:e}=window.app,{template:i,format:a,folder:n}=me(),[o,r]=await ce(i),c=t.format(a),p=await be(n,c);try{let w=await e.create(p,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(k,T,N,A,Y,h)=>{let D=window.moment(),b=t.clone().set({hour:D.get("hour"),minute:D.get("minute"),second:D.get("second")});return N&&b.add(parseInt(A,10),Y),h?b.format(h.substring(1).trim()):b.format(a)}).replace(/{{\s*title\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(k,T,N)=>{let A=qi(T);return t.weekday(A).format(N.trim())}));return window.app.foldManager.save(w,r),w}catch(w){console.error(`Failed to create file: '${p}'`,w),new E.Notice("Unable to create new file.")}}function Ui(t,e){var i;return(i=e[R(t,"week")])!=null?i:null}function Vi(){let t={};if(!Pt())return t;let{vault:e}=window.app,{folder:i}=me(),a=e.getAbstractFileByPath(E.normalizePath(i));if(!a)throw new We("Failed to find weekly notes folder");return E.Vault.recurseChildren(a,n=>{if(n instanceof E.TFile){let o=de(n,"week");if(o){let r=R(o,"week");t[r]=n}}}),t}var qe=class extends Error{};async function Tt(t){let{vault:e}=window.app,{template:i,format:a,folder:n}=fe(),[o,r]=await ce(i),c=t.format(a),p=await be(n,c);try{let w=await e.create(p,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(k,T,N,A,Y,h)=>{let D=window.moment(),b=t.clone().set({hour:D.get("hour"),minute:D.get("minute"),second:D.get("second")});return N&&b.add(parseInt(A,10),Y),h?b.format(h.substring(1).trim()):b.format(a)}).replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c));return window.app.foldManager.save(w,r),w}catch(w){console.error(`Failed to create file: '${p}'`,w),new E.Notice("Unable to create new file.")}}function Hi(t,e){var i;return(i=e[R(t,"month")])!=null?i:null}function Ri(){let t={};if(!kt())return t;let{vault:e}=window.app,{folder:i}=fe(),a=e.getAbstractFileByPath(E.normalizePath(i));if(!a)throw new qe("Failed to find monthly notes folder");return E.Vault.recurseChildren(a,n=>{if(n instanceof E.TFile){let o=de(n,"month");if(o){let r=R(o,"month");t[r]=n}}}),t}var Ue=class extends Error{};async function Qi(t){let{vault:e}=window.app,{template:i,format:a,folder:n}=we(),[o,r]=await ce(i),c=t.format(a),p=await be(n,c);try{let w=await e.create(p,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(k,T,N,A,Y,h)=>{let D=window.moment(),b=t.clone().set({hour:D.get("hour"),minute:D.get("minute"),second:D.get("second")});return N&&b.add(parseInt(A,10),Y),h?b.format(h.substring(1).trim()):b.format(a)}).replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c));return window.app.foldManager.save(w,r),w}catch(w){console.error(`Failed to create file: '${p}'`,w),new E.Notice("Unable to create new file.")}}function ji(t,e){var i;return(i=e[R(t,"quarter")])!=null?i:null}function zi(){let t={};if(!Dt())return t;let{vault:e}=window.app,{folder:i}=we(),a=e.getAbstractFileByPath(E.normalizePath(i));if(!a)throw new Ue("Failed to find quarterly notes folder");return E.Vault.recurseChildren(a,n=>{if(n instanceof E.TFile){let o=de(n,"quarter");if(o){let r=R(o,"quarter");t[r]=n}}}),t}var Ve=class extends Error{};async function Bi(t){let{vault:e}=window.app,{template:i,format:a,folder:n}=Ne(),[o,r]=await ce(i),c=t.format(a),p=await be(n,c);try{let w=await e.create(p,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(k,T,N,A,Y,h)=>{let D=window.moment(),b=t.clone().set({hour:D.get("hour"),minute:D.get("minute"),second:D.get("second")});return N&&b.add(parseInt(A,10),Y),h?b.format(h.substring(1).trim()):b.format(a)}).replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c));return window.app.foldManager.save(w,r),w}catch(w){console.error(`Failed to create file: '${p}'`,w),new E.Notice("Unable to create new file.")}}function Gi(t,e){var i;return(i=e[R(t,"year")])!=null?i:null}function Ki(){let t={};if(!At())return t;let{vault:e}=window.app,{folder:i}=Ne(),a=e.getAbstractFileByPath(E.normalizePath(i));if(!a)throw new Ve("Failed to find yearly notes folder");return E.Vault.recurseChildren(a,n=>{if(n instanceof E.TFile){let o=de(n,"year");if(o){let r=R(o,"year");t[r]=n}}}),t}function Ji(){var a,n;let{app:t}=window,e=t.internalPlugins.plugins["daily-notes"];if(e&&e.enabled)return!0;let i=t.plugins.getPlugin("periodic-notes");return i&&((n=(a=i.settings)==null?void 0:a.daily)==null?void 0:n.enabled)}function Pt(){var i,a;let{app:t}=window;if(t.plugins.getPlugin("calendar"))return!0;let e=t.plugins.getPlugin("periodic-notes");return e&&((a=(i=e.settings)==null?void 0:i.weekly)==null?void 0:a.enabled)}function kt(){var i,a;let{app:t}=window,e=t.plugins.getPlugin("periodic-notes");return e&&((a=(i=e.settings)==null?void 0:i.monthly)==null?void 0:a.enabled)}function Dt(){var i,a;let{app:t}=window,e=t.plugins.getPlugin("periodic-notes");return e&&((a=(i=e.settings)==null?void 0:i.quarterly)==null?void 0:a.enabled)}function At(){var i,a;let{app:t}=window,e=t.plugins.getPlugin("periodic-notes");return e&&((a=(i=e.settings)==null?void 0:i.yearly)==null?void 0:a.enabled)}function Xi(t){let e={day:ye,week:me,month:fe,quarter:we,year:Ne}[t];return e()}function Zi(t,e){return{day:bt,month:Tt,week:vt}[t](e)}v.DEFAULT_DAILY_NOTE_FORMAT=Ye;v.DEFAULT_MONTHLY_NOTE_FORMAT=ht;v.DEFAULT_QUARTERLY_NOTE_FORMAT=yt;v.DEFAULT_WEEKLY_NOTE_FORMAT=Me;v.DEFAULT_YEARLY_NOTE_FORMAT=mt;v.appHasDailyNotesPluginLoaded=Ji;v.appHasMonthlyNotesPluginLoaded=kt;v.appHasQuarterlyNotesPluginLoaded=Dt;v.appHasWeeklyNotesPluginLoaded=Pt;v.appHasYearlyNotesPluginLoaded=At;v.createDailyNote=bt;v.createMonthlyNote=Tt;v.createPeriodicNote=Zi;v.createQuarterlyNote=Qi;v.createWeeklyNote=vt;v.createYearlyNote=Bi;v.getAllDailyNotes=xi;v.getAllMonthlyNotes=Ri;v.getAllQuarterlyNotes=zi;v.getAllWeeklyNotes=Vi;v.getAllYearlyNotes=Ki;v.getDailyNote=Mi;v.getDailyNoteSettings=ye;v.getDateFromFile=de;v.getDateFromPath=Yi;v.getDateUID=R;v.getMonthlyNote=Hi;v.getMonthlyNoteSettings=fe;v.getPeriodicNoteSettings=Xi;v.getQuarterlyNote=ji;v.getQuarterlyNoteSettings=we;v.getTemplateInfo=ce;v.getWeeklyNote=Ui;v.getWeeklyNoteSettings=me;v.getYearlyNote=Gi;v.getYearlyNoteSettings=Ne});var ia={};ai(ia,{default:()=>Oe});module.exports=ni(ia);var Q=require("obsidian"),Fe=Ae(Le());function ut(t,e){let i=Object.keys(e).map(a=>$i(t,a,e[a]));return i.length===1?i[0]:function(){i.forEach(a=>a())}}function $i(t,e,i){let a=t[e],n=t.hasOwnProperty(e),o=n?a:function(){return Object.getPrototypeOf(t)[e].apply(this,arguments)},r=i(o);return a&&Object.setPrototypeOf(r,a),Object.setPrototypeOf(c,r),t[e]=c,p;function c(...w){return r===o&&t[e]===c&&p(),r.apply(this,w)}function p(){t[e]===c&&(n?t[e]=o:delete t[e]),r!==o&&(r=o,Object.setPrototypeOf(c,a||Function))}}var Ft=Ae(require("os"));var gt="auto-periodic-notes:settings-updated";var pt=!1;function _e(t){pt=t}function u(t){pt&&console.log(`[Auto Periodic Notes] ${t}`)}var Z=require("obsidian");var M=Ae(Le()),f=Ae(St());function ea(t){var i;let e=t.plugins;return((i=e==null?void 0:e.plugins)==null?void 0:i["templater-obsidian"])||null}async function ve(t,e,i=!1){var n;let a=ea(t);if(!a){u("Templater plugin not found or not enabled");return}if(i||!((n=a==null?void 0:a.settings)!=null&&n.trigger_on_file_creation)){u(`Processing Templater commands in file: ${e.path}`);try{if(await new Promise(p=>setTimeout(p,500)),typeof a.templater.overwrite_file_commands=="function"){u("Using silent Templater processing (overwrite_file_commands)"),await a.templater.overwrite_file_commands(e),u("Templater processing completed successfully (silent)");return}u("Falling back to active file Templater processing");let o=t.workspace.getActiveFile(),r=(o==null?void 0:o.path)===e.path,c=null;r||(c=t.workspace.getLeaf("tab"),await c.openFile(e),await new Promise(p=>setTimeout(p,200))),await a.templater.overwrite_active_file_commands(),await new Promise(p=>setTimeout(p,300)),c&&!r&&c.detach(),u("Templater processing completed successfully")}catch(o){u(`Error processing Templater commands: ${o}`)}}else u("Skipping Templater processing - trigger_on_file_creation is enabled")}var ta=1e3,Te=class{constructor(e,i,a,n){this.workspace=e,this.app=i,this.plugin=a,this.waitTimeout=n||ta,this.workspaceLeaves={}}async checkAndCreateNotes(e,i){u(`Checking if any new notes need to be created (context: ${(i==null?void 0:i.scheduleName)||"manual"})`),await this.checkAndCreateSingleNote(e.yearly,new M.YearlyNote,"yearly",e.alwaysOpen,e.processTemplater,i),await this.checkAndCreateSingleNote(e.quarterly,new M.QuarterlyNote,"quarterly",e.alwaysOpen,e.processTemplater,i),await this.checkAndCreateSingleNote(e.monthly,new M.MonthlyNote,"monthly",e.alwaysOpen,e.processTemplater,i),await this.checkAndCreateSingleNote(e.weekly,new M.WeeklyNote,"weekly",e.alwaysOpen,e.processTemplater,i),await this.checkAndCreateSingleNote(e.daily,new M.DailyNote,"daily",e.alwaysOpen,e.processTemplater,i)}async checkAndCreateNextPeriodNotes(e,i){u(`Creating next period notes (context: ${(i==null?void 0:i.scheduleName)||"manual"})`),await this.checkAndCreateSingleNote(e.yearly,new M.YearlyNote,"yearly",e.alwaysOpen,e.processTemplater,i,!0),await this.checkAndCreateSingleNote(e.quarterly,new M.QuarterlyNote,"quarterly",e.alwaysOpen,e.processTemplater,i,!0),await this.checkAndCreateSingleNote(e.monthly,new M.MonthlyNote,"monthly",e.alwaysOpen,e.processTemplater,i,!0),await this.checkAndCreateSingleNote(e.weekly,new M.WeeklyNote,"weekly",e.alwaysOpen,e.processTemplater,i,!0),await this.checkAndCreateSingleNote(e.daily,new M.DailyNote,"daily",e.alwaysOpen,e.processTemplater,i,!0)}async checkAndCreateSingleNote(e,i,a,n,o,r,c=!1){var p,w,k,T;if(e.available&&e.enabled)if(this.workspaceLeaves={},u(`Checking if ${a} note needs to be created`),a==="daily"){let N=e,A=(r==null?void 0:r.scheduleName)==="scheduledTime";if(A||c||N.createTomorrowsNote||N.unpinOldDailyNotes){let h=(0,Z.moment)();if(c){if(h=h.add(1,"day"),N.excludeWeekends)for(;h.format("dd")==="Sa"||h.format("dd")==="Su";)h=h.add(1,"day");u(`Target date for next period: ${h.format("YYYY-MM-DD")}`)}else if(A&&N.createTomorrowsNote){if(h=h.add(1,"day"),N.excludeWeekends)for(;h.format("dd")==="Sa"||h.format("dd")==="Su";)h=h.add(1,"day");u(`Target date for custom scheduled time: ${h.format("YYYY-MM-DD")}`)}else if(N.excludeWeekends){let P=h.format("dd");if(P==="Sa"||P==="Su"){u("Not creating new note as it is a weekend");return}}let D=(0,f.getAllDailyNotes)(),b=(0,f.getDailyNote)(h,D);if(!b){let P=(0,f.getDailyNoteSettings)(),C=P.format||f.DEFAULT_DAILY_NOTE_FORMAT,W=((p=P.folder)==null?void 0:p.trim())||"",q=h.format(C),ie=W?`${W}/${q}.md`:`${q}.md`,H=this.app.vault.getAbstractFileByPath(ie);H&&"path"in H&&((w=H.path)!=null&&w.endsWith(".md"))&&(u(`Note not in cache but exists in filesystem: ${ie}`),b=H)}if(b){let C=(r==null?void 0:r.scheduleName)==="startup"&&e.closeExisting,W=A&&N.unpinOldDailyNotes;(n||C||W||A)&&(u(`Daily note exists for ${h.format("YYYY-MM-DD")}, handling existing tabs`),W?await this.handleUnpin(e,i,b):C&&await this.handleClose(e,i,b),await this.handleOpen(e,b,a))}else{u(`Creating daily note for ${h.format("YYYY-MM-DD")}`);let P=await(0,f.createDailyNote)(h),C=(0,Z.moment)(),W=h.isAfter(C,"day");new Z.Notice(W?"Tomorrow's daily note has been created.":"Today's daily note has been created.",5e3),A&&N.unpinOldDailyNotes?await this.handleUnpin(e,i,P):await this.handleClose(e,i,P),await this.handleOpen(e,P,a),o&&await ve(this.app,P,!0)}}else if(i.isPresent()){if(n){u(`Set to always open notes, getting current ${a} note`);let h=i.getCurrent();await this.handleClose(e,i,h),await this.handleOpen(e,h,a)}}else{if(N.excludeWeekends){let D=(0,Z.moment)();if(D.format("dd")==="Sa"||D.format("dd")==="Su"){u("Not creating new note as it is a weekend");return}}u(`Creating new ${a} note`);let h=await i.create();new Z.Notice(`Today's ${a} note has been created.`,5e3),await this.handleClose(e,i,h),await this.handleOpen(e,h,a),o&&await ve(this.app,h,!0)}}else{let N=this.getPeriodicNoteHelpers(a);if(!N){u(`Unknown term: ${a}`);return}let A=(r==null?void 0:r.scheduleName)==="scheduledTime";if(A||c){let h=(0,Z.moment)();c&&(h=this.calculateNextPeriodDate(a,h),u(`Target date for next period ${a}: ${h.format("YYYY-MM-DD")}`));let D=N.getAll(),b=N.get(h,D);if(!b){let P=N.getSettings(),C=P.format||N.defaultFormat,W=((k=P.folder)==null?void 0:k.trim())||"",q=h.format(C),ie=W?`${W}/${q}.md`:`${q}.md`,H=this.app.vault.getAbstractFileByPath(ie);H&&"path"in H&&((T=H.path)!=null&&T.endsWith(".md"))&&(u(`${a} note not in cache but exists in filesystem: ${ie}`),b=H)}if(b){let C=(r==null?void 0:r.scheduleName)==="startup"&&e.closeExisting;(n||C||A)&&(u(`${a} note exists for ${h.format("YYYY-MM-DD")}, handling existing tabs`),C&&await this.handleClose(e,i,b),await this.handleOpen(e,b,a))}else{u(`Creating ${a} note for ${h.format("YYYY-MM-DD")}`);let P=await N.create(h),C=this.getPeriodLabel(a,c);new Z.Notice(`${C} note has been created.`,5e3),await this.handleClose(e,i,P),await this.handleOpen(e,P,a),o&&await ve(this.app,P,!0)}}else if(i.isPresent()){if(n){u(`Set to always open notes, getting current ${a} note`);let h=i.getCurrent();await this.handleClose(e,i,h),await this.handleOpen(e,h,a)}}else{u(`Creating new ${a} note`);let h=await i.create();new Z.Notice(`${this.getPeriodLabel(a,!1)} note has been created.`,5e3),await this.handleClose(e,i,h),await this.handleOpen(e,h,a),o&&await ve(this.app,h,!0)}}}getOpenWorkspaceLeaves(){return Object.keys(this.workspaceLeaves).length||(this.workspace.iterateAllLeaves(e=>{var n,o,r,c;let i=(o=(n=e.view)==null?void 0:n.getViewType)==null?void 0:o.call(n),a=(c=(r=e.view)==null?void 0:r.getState)==null?void 0:c.call(r);u(`Leaf found - viewType: ${i}, state.file: ${a==null?void 0:a.file}`),(i==="markdown"||i===void 0)&&a&&typeof a.file!="undefined"&&(this.workspaceLeaves[a.file]=e)}),u(`Found ${Object.keys(this.workspaceLeaves).length} actual file tabs open: ${Object.keys(this.workspaceLeaves).join(", ")}`)),this.workspaceLeaves}async handleClose(e,i,a){if(e.closeExisting){u("Checking for any existing notes to close");let n=i.getAllPaths(),o=[];Object.entries(this.getOpenWorkspaceLeaves()).forEach(([r,c])=>{n.indexOf(r)>-1&&r!==a.path&&o.push(c)}),u("Found "+o.length+" tab(s) to close");for(let r of o)r.detach();await new Promise(r=>setTimeout(r,this.waitTimeout))}}async handleUnpin(e,i,a){if(e.unpinOldDailyNotes){u("Unpinning all old daily notes");let o=i.getAllPaths(),r=[];Object.entries(this.getOpenWorkspaceLeaves()).forEach(([c,p])=>{o.indexOf(c)>-1&&c!==a.path&&r.push(p)}),u(`Found ${r.length} daily note tab(s) to unpin`);for(let c of r)c.setPinned(!1)}}async handleOpen(e,i,a){var r,c,p,w;let n=this.getOpenWorkspaceLeaves(),o=Object.keys(n).indexOf(i.path)!==-1;if(u(`handleOpen called: openAndPin=${e.openAndPin}, notePath=${i.path}, isAlreadyOpen=${o}, openLeavesCount=${Object.keys(n).length}`),e.openAndPin&&!o){u("Opening note in new tab");let k=a==="daily"&&"openAtFirstPosition"in e&&e.openAtFirstPosition,T;if(k){this.plugin.setDailyNoteCreation(!0);try{T=this.workspace.getLeaf("tab"),u("Used monkey patch to create daily note leaf at first position")}finally{this.plugin.setDailyNoteCreation(!1)}}else T=this.workspace.getLeaf(!0);if(await T.openFile(i),u(`Before setPinned - leaf parent has ${((c=(r=T.parent)==null?void 0:r.children)==null?void 0:c.length)||0} children`),T.setPinned(!0),u(`After setPinned - leaf parent has ${((w=(p=T.parent)==null?void 0:p.children)==null?void 0:w.length)||0} children`),k){let N=T.parent;if(N&&N.children){let A=N.children.indexOf(T);u(`Daily note leaf is at index ${A} after pinning, moving to index 0`),A>0&&(N.children.splice(A,1),N.children.unshift(T),N.recomputeChildrenDimensions(),u("Moved daily note leaf to first position"))}}}}isEmptyLeaf(e){let i=e.view.getViewType();return["empty","home-tab-view"].includes(i)}calculateNextPeriodDate(e,i){switch(e){case"daily":return i.clone().add(1,"day");case"weekly":return i.clone().add(1,"week").startOf("week");case"monthly":return i.clone().add(1,"month").startOf("month");case"quarterly":return i.clone().add(1,"quarter").startOf("quarter");case"yearly":return i.clone().add(1,"year").startOf("year");default:return i}}getPeriodLabel(e,i){var n;return((n={daily:["Today's daily","Tomorrow's daily"],weekly:["This week's weekly","Next week's weekly"],monthly:["This month's monthly","Next month's monthly"],quarterly:["This quarter's quarterly","Next quarter's quarterly"],yearly:["This year's yearly","Next year's yearly"]}[e])==null?void 0:n[i?1:0])||`${i?"Next":"This"} ${e}`}getPeriodicNoteHelpers(e){return{daily:{create:f.createDailyNote,get:f.getDailyNote,getAll:f.getAllDailyNotes,getSettings:f.getDailyNoteSettings,defaultFormat:f.DEFAULT_DAILY_NOTE_FORMAT},weekly:{create:f.createWeeklyNote,get:f.getWeeklyNote,getAll:f.getAllWeeklyNotes,getSettings:f.getWeeklyNoteSettings,defaultFormat:f.DEFAULT_WEEKLY_NOTE_FORMAT},monthly:{create:f.createMonthlyNote,get:f.getMonthlyNote,getAll:f.getAllMonthlyNotes,getSettings:f.getMonthlyNoteSettings,defaultFormat:f.DEFAULT_MONTHLY_NOTE_FORMAT},quarterly:{create:f.createQuarterlyNote,get:f.getQuarterlyNote,getAll:f.getAllQuarterlyNotes,getSettings:f.getQuarterlyNoteSettings,defaultFormat:f.DEFAULT_QUARTERLY_NOTE_FORMAT},yearly:{create:f.createYearlyNote,get:f.getYearlyNote,getAll:f.getAllYearlyNotes,getSettings:f.getYearlyNoteSettings,defaultFormat:f.DEFAULT_YEARLY_NOTE_FORMAT}}[e]}};var Pe=Object.freeze({available:!1,enabled:!1,closeExisting:!1,openAndPin:!1}),te=Object.freeze({alwaysOpen:!1,processTemplater:!1,debug:!1,daily:{...Pe,excludeWeekends:!1,openAtFirstPosition:!1,enableAdvancedScheduling:!1,scheduledTime:"22:00",createTomorrowsNote:!1,unpinOldDailyNotes:!1},weekly:{...Pe},monthly:{...Pe},quarterly:{...Pe},yearly:{...Pe},deviceSettings:{}});function Ot(t){var i,a,n,o;return{alwaysOpen:(i=t==null?void 0:t.alwaysOpen)!=null?i:te.alwaysOpen,processTemplater:(a=t==null?void 0:t.processTemplater)!=null?a:te.processTemplater,debug:(n=t==null?void 0:t.debug)!=null?n:te.debug,daily:{...te.daily,...t==null?void 0:t.daily},weekly:{...te.weekly,...t==null?void 0:t.weekly},monthly:{...te.monthly,...t==null?void 0:t.monthly},quarterly:{...te.quarterly,...t==null?void 0:t.quarterly},yearly:{...te.yearly,...t==null?void 0:t.yearly},deviceSettings:(o=t==null?void 0:t.deviceSettings)!=null?o:{}}}var L=require("obsidian"),ke=class extends L.PluginSettingTab{constructor(e,i){super(e,i),this.plugin=i}display(){var n,o;this.containerEl.empty();let e=this.plugin.settings,i=["daily","weekly","monthly","quarterly","yearly"];if(!e.daily.available&&!e.weekly.available&&!e.monthly.available&&!e.quarterly.available&&!e.yearly.available){let r=this.containerEl.createDiv({cls:"settings-banner"});new L.Setting(r).setName("No periodic notes enabled").setHeading().setDesc("No periodic notes settings are enabled. You must turn on one of daily, weekly, monthly, quarterly or yearly notes within the Periodic Notes plugin settings to be able to configure them to generate automatically.")}this.containerEl.createEl("h3",{text:"General settings"}),new L.Setting(this.containerEl).setName("Enable debug logging").setDesc("Enable detailed debug logging in the developer console.").addToggle(r=>{r.setValue(e.debug).onChange(async c=>{e.debug=c,await this.plugin.updateSettings(e)})}),new L.Setting(this.containerEl).setName("Always open periodic notes").setDesc("Always open your periodic notes even when they haven't just been created.").addToggle(r=>{r.setValue(e.alwaysOpen).onChange(async c=>{e.alwaysOpen=c,await this.plugin.updateSettings(e)})}),!!((o=(n=this.app.plugins)==null?void 0:n.plugins)!=null&&o["templater-obsidian"])&&new L.Setting(this.containerEl).setName("Process Templater code in automatically created notes").setDesc("Automatically process Templater syntax from notes created in the background.").addToggle(r=>{r.setValue(e.processTemplater).onChange(async c=>{e.processTemplater=c,await this.plugin.updateSettings(e)})});for(let r of i)e[r].available&&this.renderPeriodicitySection(r,e)}renderPeriodicitySection(e,i){let a=e==="daily";this.containerEl.createEl("h3",{text:`Automatic ${e} notes`}),new L.Setting(this.containerEl).setName(`Enable automatic ${e} notes`).setDesc(`Create new ${e} notes automatically using periodic notes location and template.`).addToggle(n=>{n.setValue(i[e].enabled).onChange(async o=>{i[e].enabled=o,await this.plugin.updateSettings(i)})}),a&&new L.Setting(this.containerEl).setName("Exclude weekends").setDesc("Skip creating daily notes on Saturdays and Sundays.").addToggle(n=>{n.setValue(i.daily.excludeWeekends).onChange(async o=>{i.daily.excludeWeekends=o,await this.plugin.updateSettings(i)})}),new L.Setting(this.containerEl).setName(`Open and pin new ${e} notes`).setDesc("Automatically open and pin the new note to your tabs.").addToggle(n=>{n.setValue(i[e].openAndPin).onChange(async o=>{i[e].openAndPin=o,await this.plugin.updateSettings(i)})}),a&&new L.Setting(this.containerEl).setName("Open daily notes at first position").setDesc("Position new daily note tabs at the first position.").addToggle(n=>{n.setValue(i.daily.openAtFirstPosition).onChange(async o=>{i.daily.openAtFirstPosition=o,await this.plugin.updateSettings(i)})}),new L.Setting(this.containerEl).setName(`Close older ${e} notes`).setDesc(a?"Close older open daily notes on startup (not at custom scheduled time).":`Automatically close any older open ${e} notes.`).addToggle(n=>{n.setValue(i[e].closeExisting).onChange(async o=>{i[e].closeExisting=o,await this.plugin.updateSettings(i)})}),a&&this.renderDailyAdvancedSection(i)}renderDailyAdvancedSection(e){let i=this.containerEl.createEl("details",{cls:"setting-item-details"});i.createEl("summary",{text:"Advanced: Custom Scheduled Time",cls:"setting-item-heading"});let a=i.createDiv({cls:"setting-item-details-content"});if(new L.Setting(a).setName("Enable custom scheduled time").setDesc("Schedule an additional daily check at a custom time (e.g., 22:30 to create tomorrow's note before sleep).").addToggle(n=>{n.setValue(e.daily.enableAdvancedScheduling).onChange(async o=>{e.daily.enableAdvancedScheduling=o,await this.plugin.updateSettings(e),this.display()})}),e.daily.enableAdvancedScheduling){let n=this.plugin.getDeviceId(),o=this.plugin.getDeviceScheduledTime();new L.Setting(a).setName(`Scheduled time (${n})`).setDesc("Time for the custom check (24-hour format). This setting is device-specific and will not affect other devices.").addText(r=>{r.setPlaceholder("HH:mm (e.g., 22:30)").setValue(o).onChange(async c=>{/^([01]\d|2[0-3]):([0-5]\d)$/.test(c)||c===""?await this.plugin.setDeviceScheduledTime(c||"22:00"):new L.Notice("Invalid time format. Use HH:mm (e.g., 22:30)")})}),new L.Setting(a).setName("Create tomorrow's daily note").setDesc("At the custom scheduled time, create tomorrow's note instead of today's.").addToggle(r=>{r.setValue(e.daily.createTomorrowsNote).onChange(async c=>{e.daily.createTomorrowsNote=c,await this.plugin.updateSettings(e)})}),new L.Setting(a).setName("Unpin old daily notes").setDesc("At the custom scheduled time, unpin old daily notes instead of closing them.").addToggle(r=>{r.setValue(e.daily.unpinOldDailyNotes).onChange(async c=>{e.daily.unpinOldDailyNotes=c,await this.plugin.updateSettings(e)})})}}};var Oe=class extends Q.Plugin{constructor(i,a){super(i,a);this.isDailyNoteCreation=!1;this.scheduledTimeouts={scheduledTime:null};this.lastVisibilityCheckTime=0;this.settings={},this.periodicNotesPlugin=new Fe.PeriodicNotesPluginAdapter(i),this.notes=new Te(i.workspace,i,this)}async onload(){this.updateSettings=this.updateSettings.bind(this),await this.loadSettings(),this.setupWorkspacePatches(),this.app.workspace.onLayoutReady(this.onLayoutReady.bind(this))}onLayoutReady(){if(!this.periodicNotesPlugin.isEnabled()){new Q.Notice("The Periodic Notes plugin must be installed and available for Auto Periodic Notes to work.",1e4);return}let i=this.app.workspace;this.registerEvent(i.on(Fe.PERIODIC_NOTES_EVENT_SETTING_UPDATED,this.syncPeriodicNotesSettings.bind(this))),this.syncPeriodicNotesSettings(),this.addSettingTab(new ke(this.app,this)),this.executeStartupLogic().catch(a=>{u(`Error during startup: ${a.message}`),console.error("Auto Periodic Notes: Failed during startup",a),new Q.Notice("Auto Periodic Notes: Failed during startup. Check console for details.")}),this.scheduleAllDailyChecks(),this.register(this.clearAllScheduledTimeouts.bind(this)),this.setupVisibilityListener()}async loadSettings(){this.settings=Ot(await this.loadData()),_e(this.settings.debug),u("Loaded settings: "+JSON.stringify(this.settings))}async updateSettings(i){this.settings=i,_e(this.settings.debug),await this.saveData(this.settings),this.onSettingsUpdate(),this.scheduleDailyCheck(),u("Saved settings: "+JSON.stringify(this.settings))}syncPeriodicNotesSettings(){u("Received new settings from Periodic Notes plugin");let i=this.periodicNotesPlugin.convertSettings();this.settings.daily.available=i.daily.available,this.settings.weekly.available=i.weekly.available,this.settings.monthly.available=i.monthly.available,this.settings.quarterly.available=i.quarterly.available,this.settings.yearly.available=i.yearly.available,this.updateSettings(this.settings)}onSettingsUpdate(){this.app.workspace.trigger(gt)}setupWorkspacePatches(){let i=this;this.monkeyPatchCleanup=ut(Q.Workspace.prototype,{getLeaf:a=>function(n){return i.isDailyNoteCreation&&i.settings.daily.openAtFirstPosition?(u("Intercepted getLeaf call for daily note - creating at first position"),i.createLeafAtFirstPosition()):a.call(this,n)}}),this.register(()=>{this.monkeyPatchCleanup&&(this.monkeyPatchCleanup(),u("Cleaned up monkey patch"))})}createLeafAtFirstPosition(){let i=this.app.workspace.getMostRecentLeaf();if(!i){let o=this.isDailyNoteCreation;this.isDailyNoteCreation=!1;let r=this.app.workspace.getLeaf("tab");return this.isDailyNoteCreation=o,r}let a=i.parent,n=a.children;if(n&&n.length>0){let o=n[0],r=o.view.getViewType();if(["empty","home-tab-view"].includes(r))return u("Reusing empty leaf at first position"),o}try{let o=new Q.WorkspaceLeaf(this.app);return a.insertChild(0,o),u("Created new leaf at first position via monkey patch"),o}catch(o){u("Failed to create leaf at first position, using fallback: "+o);let r=this.isDailyNoteCreation;this.isDailyNoteCreation=!1;let c=this.app.workspace.getLeaf("tab");return this.isDailyNoteCreation=r,c}}setDailyNoteCreation(i){this.isDailyNoteCreation=i}getDeviceId(){return Ft.hostname()}getDeviceScheduledTime(){var a,n,o,r;let i=this.getDeviceId();return(r=(o=(n=(a=this.settings.deviceSettings)==null?void 0:a[i])==null?void 0:n.scheduledTime)!=null?o:this.settings.daily.scheduledTime)!=null?r:""}async setDeviceScheduledTime(i){let a=this.getDeviceId();this.settings.deviceSettings||(this.settings.deviceSettings={}),this.settings.deviceSettings[a]||(this.settings.deviceSettings[a]={scheduledTime:""}),this.settings.deviceSettings[a].scheduledTime=i,await this.saveData(this.settings),this.onSettingsUpdate(),u(`Device ${a} scheduled time changed to ${i}, rescheduling...`),this.scheduleDailyCheck()}getLastExecutionDate(){var a,n,o;let i=this.getDeviceId();return(o=(n=(a=this.settings.deviceSettings)==null?void 0:a[i])==null?void 0:n.lastExecutionDate)!=null?o:null}async setLastExecutionDate(i){let a=this.getDeviceId();this.settings.deviceSettings||(this.settings.deviceSettings={}),this.settings.deviceSettings[a]||(this.settings.deviceSettings[a]={scheduledTime:""}),this.settings.deviceSettings[a].lastExecutionDate=i,await this.saveData(this.settings)}scheduleDailyCheck(){let i=this.settings.daily,a=this.getDeviceScheduledTime(),n=this.getDeviceId();if(u(`[scheduledTime] Checking settings for device ${n}: enableAdvancedScheduling=${i.enableAdvancedScheduling}, scheduledTime=${a}`),!i.enableAdvancedScheduling||!a){u("[scheduledTime] Not scheduling - conditions not met"),this.clearScheduledTimeout("scheduledTime");return}if(!/^([01]\d|2[0-3]):([0-5]\d)$/.test(a)){u(`[scheduledTime] Not scheduling - invalid time format: ${a}`),this.clearScheduledTimeout("scheduledTime");return}this.clearScheduledTimeout("scheduledTime");let r=new Date,c=new Date(r),[p,w]=this.parseScheduledTime(a);c.setHours(p,w,0,0),c<=r&&c.setDate(c.getDate()+1);let k=c.getTime()-r.getTime(),T=c.getTime();u(`[scheduledTime] Scheduled for ${c.toISOString()} (in ${k}ms)`),this.scheduledTimeouts.scheduledTime=window.setTimeout(async()=>{try{let N=Date.now(),A=Math.abs(N-T),Y=5*60*1e3;if(A>Y){u(`[scheduledTime] Skipped - triggered ${Math.round(A/1e3/60)}min away from target (likely sleep recovery)`),this.scheduleDailyCheck();return}await this.executeCustomScheduledTask(!0)}catch(N){u(`Error in scheduledTime: ${N.message}`),console.error("Auto Periodic Notes: Failed during custom scheduled check",N),new Q.Notice("Auto Periodic Notes: Failed to create notes at scheduled time. Check console for details.")}finally{this.scheduleDailyCheck()}},k)}scheduleAllDailyChecks(){this.scheduleDailyCheck()}setupVisibilityListener(){u("[Visibility] Setting up visibility change listener");let i=async()=>{document.hidden||(u("[Visibility] Window became visible, checking for missed schedules"),console.log("[Auto Periodic Notes] Window became visible, checking scheduled tasks..."),await this.onWindowBecameVisible())};document.addEventListener("visibilitychange",i),this.register(()=>{document.removeEventListener("visibilitychange",i),u("[Visibility] Visibility listener removed")}),u("[Visibility] Visibility listener registered")}async onWindowBecameVisible(){let i=Date.now();if(i-this.lastVisibilityCheckTime<5e3){u("[Visibility] Skipping - debounce (last check was < 5s ago)");return}if(this.lastVisibilityCheckTime=i,!this.settings.daily.enableAdvancedScheduling){u("[Visibility] Advanced scheduling not enabled, skipping");return}let a=this.getDeviceScheduledTime();if(!a){u("[Visibility] No scheduled time configured, skipping");return}let n=new Date,o=n.toISOString().split("T")[0],[r,c]=this.parseScheduledTime(a),p=new Date(n);p.setHours(r,c,0,0);let w=n.getTime(),k=p.getTime();u(`[Visibility] Checking: now=${n.toISOString()}, target=${p.toISOString()}, lastExecution=${this.getLastExecutionDate()}`),w<k?(u("[Visibility] Before scheduled time, running startup check and rescheduling"),console.log(`[Auto Periodic Notes] Before scheduled time ${a}, checking today's notes...`),await this.notes.checkAndCreateNotes(this.settings,{scheduleName:"startup"}),this.scheduleDailyCheck()):this.getLastExecutionDate()!==o?(u("[Visibility] After scheduled time and not executed today, triggering now"),console.log(`[Auto Periodic Notes] Missed scheduled time ${a}, executing now...`),await this.executeCustomScheduledTask(!1)):(u("[Visibility] After scheduled time but already executed today, skipping"),console.log(`[Auto Periodic Notes] Already executed today at ${a}, skipping`))}async executeCustomScheduledTask(i=!0){let a=new Date,n=a.toISOString().split("T")[0];try{console.log(`[Auto Periodic Notes] Executing scheduled task at ${a.toLocaleTimeString()} (${i?"on-time":"late"})`),console.log("[Auto Periodic Notes] Creating next period notes (tomorrow)"),await this.notes.checkAndCreateNextPeriodNotes(this.settings,{scheduleName:"scheduledTime"}),await this.setLastExecutionDate(n),u(`[Execution] Marked and persisted execution date: ${n}`),console.log("[Auto Periodic Notes] Scheduled task completed successfully")}catch(o){u(`Error during scheduled task: ${o.message}`),console.error("Auto Periodic Notes: Failed to execute scheduled task",o),new Q.Notice("Auto Periodic Notes: Failed to create notes. Check console for details.")}}async executeStartupLogic(){if(!this.settings.daily.enableAdvancedScheduling){u("[Startup] Advanced scheduling not enabled, using today startup logic"),await this.notes.checkAndCreateNotes(this.settings,{scheduleName:"startup"});return}let i=this.getDeviceScheduledTime();if(!i){u("[Startup] No scheduled time configured, using today startup logic"),await this.notes.checkAndCreateNotes(this.settings,{scheduleName:"startup"});return}let a=new Date,[n,o]=this.parseScheduledTime(i),r=new Date(a);r.setHours(n,o,0,0);let c=a.getTime(),p=r.getTime();u(`[Startup] Checking: now=${a.toISOString()}, scheduledTime=${i}, target=${r.toISOString()}`),c>p?(u("[Startup] After scheduled time, executing scheduled task directly"),console.log(`[Auto Periodic Notes] Startup after ${i}, creating tomorrow's note...`),await this.executeCustomScheduledTask(!1)):(u("[Startup] Before scheduled time, using today startup logic"),console.log(`[Auto Periodic Notes] Startup before ${i}, creating today's note...`),await this.notes.checkAndCreateNotes(this.settings,{scheduleName:"startup"}))}parseScheduledTime(i){let a=i.match(/^([01]\d|2[0-3]):([0-5]\d)$/);return a?[parseInt(a[1],10),parseInt(a[2],10)]:(u(`Invalid scheduled time: ${i}, using default 00:00`),[0,2])}clearScheduledTimeout(i){this.scheduledTimeouts[i]!==null&&(window.clearTimeout(this.scheduledTimeouts[i]),this.scheduledTimeouts[i]=null,u(`Cleared timeout: ${i}`))}clearAllScheduledTimeouts(){Object.keys(this.scheduledTimeouts).forEach(i=>{this.clearScheduledTimeout(i)})}};
